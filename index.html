<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Teachers Desk</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-purple': '#42047e',
                        'custom-cyan': '#07f49e',
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Sparkles = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                <path d="M5 3v4"/>
                <path d="M19 17v4"/>
                <path d="M3 5h4"/>
                <path d="M17 19h4"/>
            </svg>
        );

        const BookOpen = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );

        const Target = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
        );

        const Lightbulb = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/>
                <path d="M9 18h6"/>
                <path d="M10 22h4"/>
            </svg>
        );

        const FileText = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <line x1="10" y1="9" x2="8" y2="9"/>
            </svg>
        );

        const Upload = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const X = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const Loader2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        function App() {
            const [rubric, setRubric] = useState('');
            const [assignment, setAssignment] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [rubricFile, setRubricFile] = useState(null);
            const [assignmentFile, setAssignmentFile] = useState(null);
            const [assignmentPreview, setAssignmentPreview] = useState(null);
            const [rubricPreview, setRubricPreview] = useState(null);

            const handleFileUpload = async (file, type) => {
                try {
                    let extractedText = '';
                    let previewData = null;
                    const fileName = file.name.toLowerCase();

                    if (fileName.endsWith('.pdf')) {
                        // Extract text from PDF
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            extractedText += `Slide ${i}:\n${pageText}\n\n`;
                        }
                    } else if (fileName.endsWith('.docx')) {
                        // Extract text from Word document
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.extractRawText({ arrayBuffer });
                        extractedText = result.value;
                    } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                        // Extract text from Excel
                        const arrayBuffer = await file.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        
                        // Generate preview data
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const range = XLSX.utils.decode_range(firstSheet['!ref']);
                        const previewRows = Math.min(5, range.e.r + 1);
                        const previewCols = Math.min(5, range.e.c + 1);
                        
                        previewData = {
                            type: 'spreadsheet',
                            sheets: workbook.SheetNames,
                            rows: previewRows,
                            cols: previewCols,
                            data: []
                        };
                        
                        for (let r = 0; r < previewRows; r++) {
                            const row = [];
                            for (let c = 0; c < previewCols; c++) {
                                const cellAddress = XLSX.utils.encode_cell({ r, c });
                                const cell = firstSheet[cellAddress];
                                row.push(cell ? cell.v : '');
                            }
                            previewData.data.push(row);
                        }
                        
                        workbook.SheetNames.forEach(sheetName => {
                            const sheet = workbook.Sheets[sheetName];
                            const sheetText = XLSX.utils.sheet_to_txt(sheet);
                            extractedText += `Sheet: ${sheetName}\n${sheetText}\n\n`;
                        });
                    } else if (fileName.endsWith('.pptx') || fileName.endsWith('.ppt')) {
                        // PowerPoint files - extract using JSZip to read the XML content
                        const arrayBuffer = await file.arrayBuffer();
                        try {
                            const zip = await JSZip.loadAsync(arrayBuffer);
                            let slideNumber = 1;
                            const slides = [];
                            
                            // Look for slide files in the presentation
                            const slideFiles = Object.keys(zip.files).filter(name => 
                                name.match(/ppt\/slides\/slide\d+\.xml/)
                            ).sort();
                            
                            for (const slideFile of slideFiles) {
                                const content = await zip.files[slideFile].async('text');
                                // Extract text from XML by removing tags
                                const textMatches = content.match(/<a:t>([^<]+)<\/a:t>/g);
                                if (textMatches) {
                                    const slideText = textMatches
                                        .map(match => match.replace(/<\/?a:t>/g, ''))
                                        .join(' ');
                                    extractedText += `Slide ${slideNumber}:\n${slideText}\n\n`;
                                    slides.push({ number: slideNumber, text: slideText });
                                }
                                slideNumber++;
                            }
                            
                            previewData = {
                                type: 'presentation',
                                slideCount: slides.length,
                                slides: slides.slice(0, 3) // Preview first 3 slides
                            };
                            
                            if (!extractedText.trim()) {
                                extractedText = 'PowerPoint file uploaded successfully. Text extraction may be limited. Please review your slides and paste any important content into the text area below if needed.';
                            }
                        } catch (zipError) {
                            console.error('Error extracting PowerPoint:', zipError);
                            extractedText = 'PowerPoint file uploaded. Unable to extract text automatically. Please paste your slide content below.';
                        }
                    } else if (fileName.endsWith('.txt')) {
                        // Plain text file
                        extractedText = await file.text();
                    } else {
                        // Try reading as text for other formats
                        extractedText = await file.text();
                    }

                    if (type === 'rubric') {
                        setRubric(extractedText);
                        setRubricFile({ name: file.name });
                        setRubricPreview(previewData);
                    } else {
                        setAssignment(extractedText);
                        setAssignmentFile({ name: file.name });
                        setAssignmentPreview(previewData);
                    }
                } catch (error) {
                    console.error('File upload error:', error);
                    alert(`Failed to extract text from ${file.name}. Please try a different format or copy/paste the text directly.`);
                }
            };

            const removeFile = (type) => {
                if (type === 'rubric') {
                    setRubricFile(null);
                    setRubric('');
                    setRubricPreview(null);
                } else {
                    setAssignmentFile(null);
                    setAssignment('');
                    setAssignmentPreview(null);
                }
            };

            const handleAnalyze = async () => {
                if (!rubric.trim() || !assignment.trim()) return;
                
                setIsAnalyzing(true);
                setFeedback(null);

                try {
                    // Detect document type based on file extension or content
                    let documentType = 'essay'; // default
                    let documentTypeDescription = 'written document/essay';
                    
                    if (assignmentFile) {
                        const fileName = assignmentFile.name.toLowerCase();
                        if (fileName.endsWith('.pptx') || fileName.endsWith('.ppt')) {
                            documentType = 'presentation';
                            documentTypeDescription = 'presentation/slideshow';
                        } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                            documentType = 'spreadsheet';
                            documentTypeDescription = 'spreadsheet/data analysis';
                        }
                    }

                    // Build the analysis prompt
                    let analysisPrompt = `You are an experienced educator providing constructive feedback on student work. Analyze this ${documentTypeDescription} against the provided rubric.

RUBRIC:
${rubric}

STUDENT'S WORK:
${assignment}

Provide HONEST, SPECIFIC, and ACTIONABLE feedback. Be direct about problems but constructive.

`;

                    if (documentType === 'presentation') {
                        analysisPrompt += `Focus on: slide design, text density, visuals, flow, engagement, and citations.\n`;
                    } else if (documentType === 'spreadsheet') {
                        analysisPrompt += `Focus on: data accuracy, formulas, calculations, charts, formatting, and analysis.\n`;
                    } else {
                        analysisPrompt += `Focus on: thesis, evidence, organization, critical thinking, and writing quality.\n`;
                    }

                    analysisPrompt += `
Return ONLY valid JSON in this exact format (no markdown, no code fences):
{
  "overall_impression": "2-3 sentence honest assessment",
  "strengths": [
    {"area": "strength name", "observation": "specific observation"}
  ],
  "growth_areas": [
    {"rubric_criterion": "criterion with status", "guiding_question": "specific problem with examples", "encouragement": "concrete action steps"}
  ],
  "reflection_prompts": ["question 1", "question 2", "question 3", "question 4"],
  "next_steps": "numbered action plan"
}`;

                    // Try to call the API (this will work if API access is configured)
                    try {
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "anthropic-version": "2023-06-01"
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 4000,
                                messages: [
                                    {
                                        role: "user",
                                        content: analysisPrompt
                                    }
                                ]
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            
                            // Extract text from Claude's response
                            let responseText = '';
                            for (const block of data.content) {
                                if (block.type === 'text') {
                                    responseText += block.text;
                                }
                            }

                            // Clean and parse JSON
                            const cleanResponse = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                            const feedbackData = JSON.parse(cleanResponse);
                            
                            setFeedback(feedbackData);
                            setIsAnalyzing(false);
                            return;
                        }
                    } catch (apiError) {
                        console.log('API not available, using local analysis:', apiError);
                    }

                    // Fallback: Generate intelligent local feedback
                    const localFeedback = await generateLocalFeedback(rubric, assignment, documentType);
                    setFeedback(localFeedback);
                    
                } catch (error) {
                    console.error('Analysis error:', error);
                    alert('Failed to analyze your work. Please check that both your rubric and assignment are properly filled in and try again.');
                } finally {
                    setIsAnalyzing(false);
                }
            };

            // Local feedback generator using rule-based analysis
            const generateLocalFeedback = async (rubric, assignment, documentType) => {
                // Analyze the assignment
                const wordCount = assignment.trim().split(/\s+/).length;
                const paragraphCount = assignment.split(/\n\n+/).filter(p => p.trim()).length;
                const hasEvidence = /\(.*\d{4}.*\)|according to|research shows|study|data|statistics/i.test(assignment);
                const hasCitations = /\[.*\]|\(.*\)/.test(assignment);
                
                let feedback = {
                    overall_impression: "",
                    strengths: [],
                    growth_areas: [],
                    reflection_prompts: [],
                    next_steps: ""
                };

                if (documentType === 'presentation') {
                    // Presentation analysis
                    const slideCount = (assignment.match(/Slide \d+:/g) || []).length;
                    
                    feedback.overall_impression = `I've analyzed your ${slideCount}-slide presentation against the rubric. While you've covered the basic structure, there are several areas that need strengthening to meet the rubric standards fully.`;
                    
                    feedback.strengths = [
                        {
                            area: "Content Organization",
                            observation: `You've organized content across ${slideCount} slides, showing planning and structure.`
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Visual Design & Content Balance",
                            guiding_question: `Your slides appear text-heavy based on the content. Each slide should have 3-5 key points maximum with supporting visuals. Review each slide: can you replace paragraphs with bullet points and diagrams?`,
                            encouragement: "Create visual hierarchy: use larger fonts for headers, add relevant images or charts, and move detailed text to speaker notes."
                        },
                        {
                            rubric_criterion: "Evidence & Research",
                            guiding_question: hasEvidence ? "While you've included some data, ensure each major claim has a source citation visible on the slide." : "Your presentation lacks concrete evidence and research. Where are your statistics, expert quotes, or case studies to support your points?",
                            encouragement: "Add 3-5 credible sources throughout your presentation with proper citations on the slides where data appears."
                        }
                    ];
                    
                } else if (documentType === 'spreadsheet') {
                    // Spreadsheet analysis
                    const hasFormulas = /SUM|AVERAGE|COUNT|IF|VLOOKUP/i.test(assignment);
                    const hasSheets = /Sheet:/g.test(assignment);
                    
                    feedback.overall_impression = `I've reviewed your spreadsheet. While you've entered data, there are critical gaps in calculations, visualization, and professional formatting that need addressing.`;
                    
                    feedback.strengths = [
                        {
                            area: "Data Entry",
                            observation: hasSheets ? "You've organized data across multiple sheets, showing organizational thinking." : "You've started entering data into your spreadsheet."
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Formulas & Calculations (Critical Gap)",
                            guiding_question: hasFormulas ? "I see some formulas, but verify all calculations use formulas rather than manual entry. Check: are you using SUM for totals, AVERAGE for means, and appropriate functions for all computations?" : "I don't see evidence of formulas in your spreadsheet. You must use Excel functions (SUM, AVERAGE, IF, etc.) for all calculations, not manual entry. Which metrics need to be calculated?",
                            encouragement: "Replace every manual calculation with a formula. Use cell references so values update automatically."
                        },
                        {
                            rubric_criterion: "Data Visualization & Analysis",
                            guiding_question: "Where are your charts and graphs? Raw numbers alone don't show trends or patterns. What 2-3 charts would make your key findings immediately visible?",
                            encouragement: "Create bar/line/pie charts for your most important data. Add a summary sheet that interprets what the numbers mean."
                        }
                    ];
                    
                } else {
                    // Essay/written work analysis
                    feedback.overall_impression = `I've reviewed your ${wordCount}-word submission with ${paragraphCount} paragraphs. While you've addressed the topic, there are significant gaps in meeting the rubric criteria that need attention.`;
                    
                    feedback.strengths = [
                        {
                            area: "Basic Structure",
                            observation: paragraphCount >= 3 ? `You've organized your work into ${paragraphCount} paragraphs with introduction and conclusion.` : "You've attempted to structure your work."
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Evidence & Support (Major Gap)",
                            guiding_question: hasEvidence ? "While you've included some evidence, each major claim needs direct support. Go paragraph by paragraph: does every assertion have a citation, example, or data point?" : "Your work lacks concrete evidence. You're making claims without backing them up. Which credible sources could you cite to support each main point?",
                            encouragement: "Add at least 3-5 pieces of specific evidence (quotes, statistics, examples) from credible sources. Cite them properly."
                        },
                        {
                            rubric_criterion: "Depth of Analysis",
                            guiding_question: "Are you analyzing or just summarizing? After presenting information, do you explain WHY it matters and what it MEANS for your argument? Where can you add deeper interpretation?",
                            encouragement: "After each piece of evidence, add 2-3 sentences explaining its significance and connecting it to your thesis."
                        },
                        {
                            rubric_criterion: "Organization & Flow",
                            guiding_question: wordCount < 300 ? "Your work is quite brief. Does it fully address all rubric criteria? Which sections need expansion?" : "Review your transitions between ideas. Does each paragraph connect logically to the next? Are topic sentences clear?",
                            encouragement: "Create an outline of your current structure. If it doesn't flow logically, reorganize paragraphs for better coherence."
                        }
                    ];
                }

                // Common reflection prompts
                feedback.reflection_prompts = [
                    "Which specific rubric criterion am I weakest in, and what concrete evidence shows this gap?",
                    "If I had to explain my main argument/findings to someone unfamiliar with the topic, what would I say?",
                    "What's the single most important improvement I could make that would have the biggest impact on my grade?",
                    "Am I actually answering the assignment prompt, or have I drifted to a related but different topic?",
                    "If I score myself honestly against each rubric criterion, where do I fall short and why?"
                ];

                // Document-specific next steps
                if (documentType === 'presentation') {
                    feedback.next_steps = "Action plan: (1) Reduce text on each slide by 50% - aim for 3-5 bullets max. (2) Add 3-5 relevant visuals (images, charts, diagrams). (3) Create section divider slides. (4) Add source citations on data slides. (5) Write compelling opening and closing slides. (6) Move detailed content to speaker notes.";
                } else if (documentType === 'spreadsheet') {
                    feedback.next_steps = "Action plan: (1) Verify all data is complete and accurate. (2) Replace manual calculations with formulas. (3) Create 2-3 charts showing key findings. (4) Add professional formatting: headers, borders, colors. (5) Create a summary sheet explaining findings. (6) Test formulas by changing values.";
                } else {
                    feedback.next_steps = "Action plan: (1) Score yourself honestly on each rubric criterion. (2) Identify your 2-3 biggest gaps. (3) Find 3-5 pieces of concrete evidence to add. (4) After each evidence piece, add analysis explaining significance. (5) Reorganize paragraphs for logical flow. (6) Strengthen introduction and conclusion.";
                }

                return feedback;
            };

            const canAnalyze = rubric.trim().length > 0 && assignment.trim().length > 0;

            return (
                <div className="min-h-screen" style={{background: 'linear-gradient(to bottom, #42047e, #07f49e)'}}>
                    {/* Hero Section */}
                    <div className="relative overflow-hidden">
                        <div className="absolute inset-0 bg-[#1e3a5f] opacity-[0.02]"></div>
                        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-12">
                            <div className="text-center max-w-3xl mx-auto">
                                <h1 className="text-5xl sm:text-6xl font-bold text-white tracking-tight mb-3">
                                    The Teachers Desk
                                </h1>
                                <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 text-white text-sm font-medium mb-6">
                                    <Sparkles />
                                    Supportive Learning Assistant
                                </div>
                                <h2 className="text-3xl sm:text-4xl font-bold text-white tracking-tight mb-4">
                                    Grow Your Work,
                                    <span className="block text-[#07f49e]">Your Way</span>
                                </h2>
                                <p className="text-lg text-white/90 leading-relaxed">
                                    Get thoughtful guidance on your assignments without compromising your learning. 
                                    We help you discover improvements yourselfâ€”no answers, just support.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Features */}
                    <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 -mt-4 mb-12">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div className="flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                                <div className="w-12 h-12 rounded-xl bg-[#f97316]/10 flex items-center justify-center flex-shrink-0">
                                    <BookOpen />
                                </div>
                                <div>
                                    <h3 className="font-semibold text-[#1e3a5f]">Rubric-Aligned</h3>
                                    <p className="text-sm text-slate-500">Feedback based on your specific criteria</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                                <div className="w-12 h-12 rounded-xl bg-[#f97316]/10 flex items-center justify-center flex-shrink-0">
                                    <Target />
                                </div>
                                <div>
                                    <h3 className="font-semibold text-[#1e3a5f]">Growth-Focused</h3>
                                    <p className="text-sm text-slate-500">Identifies areas for improvement</p>
                                </div>
                            </div>
                        </div>
                        <div className="p-5 rounded-2xl bg-white border border-slate-100 shadow-sm">
                            <div className="flex items-start gap-4">
                                <div className="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center flex-shrink-0 mt-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 16v-4"/>
                                        <path d="M12 8h.01"/>
                                    </svg>
                                </div>
                                <div className="flex-1">
                                    <h3 className="font-semibold text-[#1e3a5f] mb-2">Using Google Docs, Sheets, or Slides?</h3>
                                    <p className="text-sm text-slate-600 mb-3">
                                        Google files can't be uploaded directly from your computer since they're stored in the cloud. 
                                        To use them with The Teachers Desk, you'll need to download or export them first:
                                    </p>
                                    <div className="space-y-2 text-sm text-slate-700">
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">1.</span>
                                            <p>Open your Google Doc, Sheet, or Slide</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">2.</span>
                                            <p>Click <strong>File</strong> in the top menu</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">3.</span>
                                            <p>Select <strong>Download</strong> and choose your preferred format:</p>
                                        </div>
                                        <div className="ml-7 space-y-1.5 text-xs bg-slate-50 p-3 rounded-lg border border-slate-200">
                                            <p>â€¢ <strong>Google Docs</strong> â†’ Download as PDF (.pdf) or Word (.docx)</p>
                                            <p>â€¢ <strong>Google Sheets</strong> â†’ Download as Excel (.xlsx)</p>
                                            <p>â€¢ <strong>Google Slides</strong> â†’ Download as PDF (.pdf) or PowerPoint (.pptx)</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">4.</span>
                                            <p>Upload the downloaded file using the upload buttons above</p>
                                        </div>
                                    </div>
                                    <p className="text-xs text-slate-500 mt-3 italic">
                                        ðŸ’¡ Tip: PDF format works best for preserving your formatting!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Input Section */}
                            <div className="space-y-6">
                                <div className="border-0 shadow-lg shadow-slate-200/50 overflow-hidden rounded-lg bg-white">
                                    <div className="bg-gradient-to-r from-[#1e3a5f] to-[#2d4a6f] text-white pb-8 p-6">
                                        <h3 className="text-xl font-semibold mb-2">Submit Your Work</h3>
                                        <p className="text-slate-300 text-sm">
                                            Paste your rubric and assignment to receive supportive feedback
                                        </p>
                                    </div>
                                    <div className="p-6 space-y-6">
                                        {/* Rubric Section */}
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <FileText />
                                                    <label className="text-sm font-medium text-slate-700">
                                                        Assignment Rubric
                                                    </label>
                                                </div>
                                                <div className="relative">
                                                    <input
                                                        type="file"
                                                        accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt"
                                                        onChange={(e) => e.target.files[0] && handleFileUpload(e.target.files[0], 'rubric')}
                                                        className="hidden"
                                                        id="rubric-upload"
                                                    />
                                                    <button
                                                        onClick={() => document.getElementById('rubric-upload').click()}
                                                        className="text-xs px-3 py-1.5 border border-slate-300 rounded-md hover:bg-slate-50 flex items-center gap-1"
                                                    >
                                                        <Upload />
                                                        Upload File
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            {rubricFile && (
                                                <div className="flex items-center gap-2 p-2 bg-[#1e3a5f]/5 rounded-lg">
                                                    <FileText />
                                                    <span className="text-xs text-slate-600 flex-1 truncate">{rubricFile.name}</span>
                                                    <button
                                                        className="h-6 w-6 hover:bg-slate-200 rounded flex items-center justify-center"
                                                        onClick={() => removeFile('rubric')}
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            )}

                                            {/* Preview for PowerPoint Rubric */}
                                            {rubricPreview && rubricPreview.type === 'presentation' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg border border-orange-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-orange-600">
                                                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-orange-900">Presentation Preview</span>
                                                        <span className="text-xs text-orange-700 ml-auto">{rubricPreview.slideCount} slides</span>
                                                    </div>
                                                    <div className="space-y-2">
                                                        {rubricPreview.slides.map((slide, idx) => (
                                                            <div key={idx} className="bg-white p-3 rounded border border-orange-200 shadow-sm">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="text-xs font-bold text-orange-600">Slide {slide.number}</span>
                                                                </div>
                                                                <p className="text-xs text-slate-700 line-clamp-2">{slide.text || 'No text content'}</p>
                                                            </div>
                                                        ))}
                                                        {rubricPreview.slideCount > 3 && (
                                                            <p className="text-xs text-orange-600 text-center italic mt-2">
                                                                + {rubricPreview.slideCount - 3} more slides
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Preview for Spreadsheet Rubric */}
                                            {rubricPreview && rubricPreview.type === 'spreadsheet' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600">
                                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                            <line x1="3" y1="9" x2="21" y2="9"/>
                                                            <line x1="3" y1="15" x2="21" y2="15"/>
                                                            <line x1="9" y1="3" x2="9" y2="21"/>
                                                            <line x1="15" y1="3" x2="15" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-green-900">Spreadsheet Preview</span>
                                                        <span className="text-xs text-green-700 ml-auto">{rubricPreview.sheets.length} sheet(s)</span>
                                                    </div>
                                                    <div className="bg-white p-2 rounded border border-green-200 overflow-x-auto">
                                                        <table className="w-full text-xs border-collapse">
                                                            <tbody>
                                                                {rubricPreview.data.map((row, ridx) => (
                                                                    <tr key={ridx} className={ridx === 0 ? 'bg-green-100 font-semibold' : ''}>
                                                                        {row.map((cell, cidx) => (
                                                                            <td key={cidx} className="border border-green-200 px-2 py-1 text-slate-700">
                                                                                {String(cell).substring(0, 20)}{String(cell).length > 20 ? '...' : ''}
                                                                            </td>
                                                                        ))}
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <p className="text-xs text-green-600 text-center italic mt-2">
                                                        Showing first {rubricPreview.rows} rows Ã— {rubricPreview.cols} columns of "{rubricPreview.sheets[0]}"
                                                    </p>
                                                </div>
                                            )}

                                            <textarea
                                                placeholder="Paste your assignment rubric here or upload a file...

Example:
â€¢ Content (40%): Demonstrates understanding of key concepts
â€¢ Organization (25%): Clear structure with logical flow
â€¢ Evidence (20%): Supports claims with relevant examples
â€¢ Mechanics (15%): Proper grammar and formatting"
                                                value={rubric}
                                                onChange={(e) => setRubric(e.target.value)}
                                                className="w-full min-h-[200px] resize-none border border-slate-200 focus:border-[#f97316] focus:ring-2 focus:ring-[#f97316]/20 rounded-xl text-sm p-3 outline-none"
                                            />
                                            <span className="text-xs text-slate-400">
                                                {rubric.length > 0 ? `${rubric.length} characters` : 'Paste text or upload PDF, Word, Excel, or text file'}
                                            </span>
                                        </div>

                                        {/* Divider */}
                                        <div className="relative">
                                            <div className="absolute inset-0 flex items-center">
                                                <div className="w-full border-t border-slate-200"></div>
                                            </div>
                                            <div className="relative flex justify-center text-xs">
                                                <span className="bg-white px-3 text-slate-400">and</span>
                                            </div>
                                        </div>

                                        {/* Assignment Section */}
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <Upload />
                                                    <label className="text-sm font-medium text-slate-700">
                                                        Your Assignment
                                                    </label>
                                                </div>
                                                <div className="relative">
                                                    <input
                                                        type="file"
                                                        accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt"
                                                        onChange={(e) => e.target.files[0] && handleFileUpload(e.target.files[0], 'assignment')}
                                                        className="hidden"
                                                        id="assignment-upload"
                                                    />
                                                    <button
                                                        onClick={() => document.getElementById('assignment-upload').click()}
                                                        className="text-xs px-3 py-1.5 border border-slate-300 rounded-md hover:bg-slate-50 flex items-center gap-1"
                                                    >
                                                        <Upload />
                                                        Upload File
                                                    </button>
                                                </div>
                                            </div>

                                            {assignmentFile && (
                                                <div className="flex items-center gap-2 p-2 bg-[#1e3a5f]/5 rounded-lg">
                                                    <FileText />
                                                    <span className="text-xs text-slate-600 flex-1 truncate">{assignmentFile.name}</span>
                                                    <button
                                                        className="h-6 w-6 hover:bg-slate-200 rounded flex items-center justify-center"
                                                        onClick={() => removeFile('assignment')}
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            )}

                                            {/* Preview for PowerPoint */}
                                            {assignmentPreview && assignmentPreview.type === 'presentation' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg border border-orange-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-orange-600">
                                                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-orange-900">Presentation Preview</span>
                                                        <span className="text-xs text-orange-700 ml-auto">{assignmentPreview.slideCount} slides</span>
                                                    </div>
                                                    <div className="space-y-2">
                                                        {assignmentPreview.slides.map((slide, idx) => (
                                                            <div key={idx} className="bg-white p-3 rounded border border-orange-200 shadow-sm">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="text-xs font-bold text-orange-600">Slide {slide.number}</span>
                                                                </div>
                                                                <p className="text-xs text-slate-700 line-clamp-2">{slide.text || 'No text content'}</p>
                                                            </div>
                                                        ))}
                                                        {assignmentPreview.slideCount > 3 && (
                                                            <p className="text-xs text-orange-600 text-center italic mt-2">
                                                                + {assignmentPreview.slideCount - 3} more slides
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Preview for Spreadsheet */}
                                            {assignmentPreview && assignmentPreview.type === 'spreadsheet' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600">
                                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                            <line x1="3" y1="9" x2="21" y2="9"/>
                                                            <line x1="3" y1="15" x2="21" y2="15"/>
                                                            <line x1="9" y1="3" x2="9" y2="21"/>
                                                            <line x1="15" y1="3" x2="15" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-green-900">Spreadsheet Preview</span>
                                                        <span className="text-xs text-green-700 ml-auto">{assignmentPreview.sheets.length} sheet(s)</span>
                                                    </div>
                                                    <div className="bg-white p-2 rounded border border-green-200 overflow-x-auto">
                                                        <table className="w-full text-xs border-collapse">
                                                            <tbody>
                                                                {assignmentPreview.data.map((row, ridx) => (
                                                                    <tr key={ridx} className={ridx === 0 ? 'bg-green-100 font-semibold' : ''}>
                                                                        {row.map((cell, cidx) => (
                                                                            <td key={cidx} className="border border-green-200 px-2 py-1 text-slate-700">
                                                                                {String(cell).substring(0, 20)}{String(cell).length > 20 ? '...' : ''}
                                                                            </td>
                                                                        ))}
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <p className="text-xs text-green-600 text-center italic mt-2">
                                                        Showing first {assignmentPreview.rows} rows Ã— {assignmentPreview.cols} columns of "{assignmentPreview.sheets[0]}"
                                                    </p>
                                                </div>
                                            )}

                                            <textarea
                                                placeholder="Paste your assignment, essay, or project work here or upload a file...

This is where you'll add the work you want feedback on. The more complete your submission, the more helpful the guidance will be."
                                                value={assignment}
                                                onChange={(e) => setAssignment(e.target.value)}
                                                className="w-full min-h-[200px] resize-none border border-slate-200 focus:border-[#f97316] focus:ring-2 focus:ring-[#f97316]/20 rounded-xl text-sm p-3 outline-none"
                                            />
                                            <span className="text-xs text-slate-400">
                                                {assignment.length > 0 ? `${assignment.length} characters` : 'Paste text or upload PDF, Word, Excel, or text file'}
                                            </span>
                                        </div>

                                        <button
                                            onClick={handleAnalyze}
                                            disabled={!canAnalyze || isAnalyzing}
                                            className="w-full h-12 bg-[#f97316] hover:bg-[#ea580c] text-white font-medium rounded-xl shadow-lg shadow-[#f97316]/25 transition-all duration-200 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed"
                                        >
                                            {isAnalyzing ? (
                                                <span className="flex items-center justify-center gap-2">
                                                    <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                                                    Analyzing...
                                                </span>
                                            ) : (
                                                <span className="flex items-center justify-center gap-2">
                                                    <Sparkles />
                                                    Get Supportive Feedback
                                                </span>
                                            )}
                                        </button>
                                        {!canAnalyze && (
                                            <p className="text-center text-xs text-slate-400 mt-3">
                                                Please provide both a rubric and your assignment
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* Trust Badge */}
                                <div className="flex items-center justify-center gap-3 text-sm text-white">
                                    <div className="w-2 h-2 rounded-full bg-green-400"></div>
                                    <span>Your work is never stored or shared</span>
                                </div>
                            </div>

                            {/* Feedback Section */}
                            <div className="lg:sticky lg:top-8 lg:self-start">
                                {isAnalyzing ? (
                                    <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg p-12 text-center">
                                        <div className="w-16 h-16 border-4 border-[#f97316]/20 border-t-[#f97316] rounded-full animate-spin mx-auto mb-4"></div>
                                        <h3 className="text-xl font-semibold text-[#1e3a5f] mb-2">
                                            Analyzing Your Work
                                        </h3>
                                        <p className="text-slate-500">
                                            Crafting personalized feedback just for you...
                                        </p>
                                    </div>
                                ) : feedback ? (
                                    <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg overflow-hidden">
                                        <div className="bg-gradient-to-r from-[#f97316] to-[#ea580c] text-white p-6">
                                            <h3 className="text-xl font-semibold mb-2">Your Feedback</h3>
                                            <p className="text-sm text-white/90">Guidance to help you grow</p>
                                        </div>
                                        <div className="p-6 space-y-6">
                                            {/* Overall Impression */}
                                            <div>
                                                <p className="text-slate-700 leading-relaxed">{feedback.overall_impression}</p>
                                            </div>

                                            {/* Strengths */}
                                            <div>
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-3 flex items-center gap-2">
                                                    âœ¨ What You're Doing Well
                                                </h4>
                                                <div className="space-y-3">
                                                    {feedback.strengths.map((strength, i) => (
                                                        <div key={i} className="bg-green-50 border border-green-100 rounded-lg p-4">
                                                            <h5 className="font-semibold text-green-900 mb-1">{strength.area}</h5>
                                                            <p className="text-sm text-green-800">{strength.observation}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Growth Areas */}
                                            <div>
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-3 flex items-center gap-2">
                                                    ðŸŒ± Opportunities for Growth
                                                </h4>
                                                <div className="space-y-4">
                                                    {feedback.growth_areas.map((area, i) => (
                                                        <div key={i} className="bg-blue-50 border border-blue-100 rounded-lg p-4">
                                                            <h5 className="font-semibold text-blue-900 mb-2">{area.rubric_criterion}</h5>
                                                            <p className="text-sm text-blue-800 mb-2 italic">ðŸ’­ {area.guiding_question}</p>
                                                            <p className="text-sm text-blue-700">{area.encouragement}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Next Steps */}
                                            <div className="bg-gradient-to-r from-[#f97316]/10 to-[#ea580c]/10 border border-[#f97316]/20 rounded-lg p-4">
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-2">ðŸŽ¯ Next Steps</h4>
                                                <p className="text-sm text-slate-700">{feedback.next_steps}</p>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg p-12 text-center">
                                        <div className="w-20 h-20 rounded-full bg-[#1e3a5f]/5 flex items-center justify-center mx-auto mb-6">
                                            <Lightbulb />
                                        </div>
                                        <h3 className="text-xl font-semibold text-[#1e3a5f] mb-2">
                                            Your Feedback Will Appear Here
                                        </h3>
                                        <p className="text-slate-500 max-w-sm mx-auto">
                                            Submit your rubric and assignment to receive personalized, 
                                            growth-focused guidance on your work.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
