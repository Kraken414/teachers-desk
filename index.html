<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Teachers Desk</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-purple': '#42047e',
                        'custom-cyan': '#07f49e',
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Sparkles = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                <path d="M5 3v4"/>
                <path d="M19 17v4"/>
                <path d="M3 5h4"/>
                <path d="M17 19h4"/>
            </svg>
        );

        const BookOpen = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );

        const Target = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <circle cx="12" cy="12" r="6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
        );

        const Lightbulb = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/>
                <path d="M9 18h6"/>
                <path d="M10 22h4"/>
            </svg>
        );

        const FileText = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <line x1="10" y1="9" x2="8" y2="9"/>
            </svg>
        );

        const Upload = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        );

        const X = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const Loader2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        function App() {
            const [rubric, setRubric] = useState('');
            const [assignment, setAssignment] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [rubricFile, setRubricFile] = useState(null);
            const [assignmentFile, setAssignmentFile] = useState(null);
            const [assignmentPreview, setAssignmentPreview] = useState(null);
            const [rubricPreview, setRubricPreview] = useState(null);

            const handleFileUpload = async (file, type) => {
                try {
                    let extractedText = '';
                    let previewData = null;
                    const fileName = file.name.toLowerCase();

                    if (fileName.endsWith('.pdf')) {
                        // Extract text from PDF
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            extractedText += `Slide ${i}:\n${pageText}\n\n`;
                        }
                    } else if (fileName.endsWith('.docx')) {
                        // Extract text from Word document
                        const arrayBuffer = await file.arrayBuffer();
                        const result = await mammoth.extractRawText({ arrayBuffer });
                        extractedText = result.value;
                    } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                        // Extract text from Excel
                        const arrayBuffer = await file.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        
                        // Generate preview data
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const range = XLSX.utils.decode_range(firstSheet['!ref']);
                        const previewRows = Math.min(5, range.e.r + 1);
                        const previewCols = Math.min(5, range.e.c + 1);
                        
                        previewData = {
                            type: 'spreadsheet',
                            sheets: workbook.SheetNames,
                            rows: previewRows,
                            cols: previewCols,
                            data: []
                        };
                        
                        for (let r = 0; r < previewRows; r++) {
                            const row = [];
                            for (let c = 0; c < previewCols; c++) {
                                const cellAddress = XLSX.utils.encode_cell({ r, c });
                                const cell = firstSheet[cellAddress];
                                row.push(cell ? cell.v : '');
                            }
                            previewData.data.push(row);
                        }
                        
                        workbook.SheetNames.forEach(sheetName => {
                            const sheet = workbook.Sheets[sheetName];
                            const sheetText = XLSX.utils.sheet_to_txt(sheet);
                            extractedText += `Sheet: ${sheetName}\n${sheetText}\n\n`;
                        });
                    } else if (fileName.endsWith('.pptx') || fileName.endsWith('.ppt')) {
                        // PowerPoint files - extract using JSZip to read the XML content
                        const arrayBuffer = await file.arrayBuffer();
                        try {
                            const zip = await JSZip.loadAsync(arrayBuffer);
                            let slideNumber = 1;
                            const slides = [];
                            
                            // Look for slide files in the presentation
                            const slideFiles = Object.keys(zip.files).filter(name => 
                                name.match(/ppt\/slides\/slide\d+\.xml/)
                            ).sort();
                            
                            for (const slideFile of slideFiles) {
                                const content = await zip.files[slideFile].async('text');
                                // Extract text from XML by removing tags
                                const textMatches = content.match(/<a:t>([^<]+)<\/a:t>/g);
                                if (textMatches) {
                                    const slideText = textMatches
                                        .map(match => match.replace(/<\/?a:t>/g, ''))
                                        .join(' ');
                                    extractedText += `Slide ${slideNumber}:\n${slideText}\n\n`;
                                    slides.push({ number: slideNumber, text: slideText });
                                }
                                slideNumber++;
                            }
                            
                            previewData = {
                                type: 'presentation',
                                slideCount: slides.length,
                                slides: slides.slice(0, 3) // Preview first 3 slides
                            };
                            
                            if (!extractedText.trim()) {
                                extractedText = 'PowerPoint file uploaded successfully. Text extraction may be limited. Please review your slides and paste any important content into the text area below if needed.';
                            }
                        } catch (zipError) {
                            console.error('Error extracting PowerPoint:', zipError);
                            extractedText = 'PowerPoint file uploaded. Unable to extract text automatically. Please paste your slide content below.';
                        }
                    } else if (fileName.endsWith('.txt')) {
                        // Plain text file
                        extractedText = await file.text();
                    } else {
                        // Try reading as text for other formats
                        extractedText = await file.text();
                    }

                    if (type === 'rubric') {
                        setRubric(extractedText);
                        setRubricFile({ name: file.name });
                        setRubricPreview(previewData);
                    } else {
                        setAssignment(extractedText);
                        setAssignmentFile({ name: file.name });
                        setAssignmentPreview(previewData);
                    }
                } catch (error) {
                    console.error('File upload error:', error);
                    alert(`Failed to extract text from ${file.name}. Please try a different format or copy/paste the text directly.`);
                }
            };

            const removeFile = (type) => {
                if (type === 'rubric') {
                    setRubricFile(null);
                    setRubric('');
                    setRubricPreview(null);
                } else {
                    setAssignmentFile(null);
                    setAssignment('');
                    setAssignmentPreview(null);
                }
            };

            const handleAnalyze = async () => {
                if (!rubric.trim() || !assignment.trim()) return;
                
                setIsAnalyzing(true);
                setFeedback(null);

                try {
                    // Detect document type based on file extension or content
                    let documentType = 'essay'; // default
                    let documentTypeDescription = 'written document/essay';
                    
                    if (assignmentFile) {
                        const fileName = assignmentFile.name.toLowerCase();
                        if (fileName.endsWith('.pptx') || fileName.endsWith('.ppt')) {
                            documentType = 'presentation';
                            documentTypeDescription = 'presentation/slideshow';
                        } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                            documentType = 'spreadsheet';
                            documentTypeDescription = 'spreadsheet/data analysis';
                        }
                    }

                    // Build the analysis prompt
                    let analysisPrompt = `You are an experienced educator providing constructive feedback on student work. Analyze this ${documentTypeDescription} against the provided rubric.

RUBRIC:
${rubric}

STUDENT'S WORK:
${assignment}

Provide HONEST, SPECIFIC, and ACTIONABLE feedback. Be direct about problems but constructive.

`;

                    if (documentType === 'presentation') {
                        analysisPrompt += `Focus on: slide design, text density, visuals, flow, engagement, and citations.\n`;
                    } else if (documentType === 'spreadsheet') {
                        analysisPrompt += `Focus on: data accuracy, formulas, calculations, charts, formatting, and analysis.\n`;
                    } else {
                        analysisPrompt += `Focus on: thesis, evidence, organization, critical thinking, and writing quality.\n`;
                    }

                    analysisPrompt += `
Return ONLY valid JSON in this exact format (no markdown, no code fences):
{
  "overall_impression": "2-3 sentence honest assessment",
  "strengths": [
    {"area": "strength name", "observation": "specific observation"}
  ],
  "growth_areas": [
    {"rubric_criterion": "criterion with status", "guiding_question": "specific problem with examples", "encouragement": "concrete action steps"}
  ],
  "reflection_prompts": ["question 1", "question 2", "question 3", "question 4"],
  "next_steps": "numbered action plan"${documentType === 'essay' ? `,
  "grammar_and_vocabulary": {
    "grammar_issues": [
      {"issue": "specific grammar mistake with exact quoted example from text", "correction": "how to fix it", "location": "where in the text (e.g., 'Found 3 instances')", "explanation": "why it matters", "impact": "IMPACT_LEVEL - detailed explanation of effect on grade/credibility"}
    ],
    "vocabulary_suggestions": [
      {"original_word": "weak word found", "occurrences": number_of_times_used, "context": "actual quoted sentence where it appears", "suggestions": ["better word 1", "better word 2", "better word 3"], "explanation": "why these alternatives are better", "impact": "IMPACT_LEVEL - how this affects overall quality"}
    ]
  },
  "ai_detection": {
    "likelihood_score": 0-100,
    "confidence_level": "Low/Medium/High",
    "analysis": "Brief explanation of the assessment",
    "indicators": [
      {"pattern": "specific pattern observed", "explanation": "why this suggests AI/human writing", "weight": "strong/moderate/weak"}
    ],
    "human_elements": ["aspect 1 that shows authentic human writing", "aspect 2"],
    "ai_elements": ["aspect 1 that suggests possible AI generation", "aspect 2"],
    "recommendation": "What this means for the submission"
  }` : ''}
}`;

                    // Try to call the API (this will work if API access is configured)
                    try {
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "anthropic-version": "2023-06-01"
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 4000,
                                messages: [
                                    {
                                        role: "user",
                                        content: analysisPrompt
                                    }
                                ]
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            
                            // Extract text from Claude's response
                            let responseText = '';
                            for (const block of data.content) {
                                if (block.type === 'text') {
                                    responseText += block.text;
                                }
                            }

                            // Clean and parse JSON
                            const cleanResponse = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                            const feedbackData = JSON.parse(cleanResponse);
                            
                            setFeedback(feedbackData);
                            setIsAnalyzing(false);
                            return;
                        }
                    } catch (apiError) {
                        console.log('API not available, using local analysis:', apiError);
                    }

                    // Fallback: Generate intelligent local feedback
                    const localFeedback = await generateLocalFeedback(rubric, assignment, documentType);
                    setFeedback(localFeedback);
                    
                } catch (error) {
                    console.error('Analysis error:', error);
                    alert('Failed to analyze your work. Please check that both your rubric and assignment are properly filled in and try again.');
                } finally {
                    setIsAnalyzing(false);
                }
            };

            // Local feedback generator using rule-based analysis
            const generateLocalFeedback = async (rubric, assignment, documentType) => {
                // Analyze the assignment
                const wordCount = assignment.trim().split(/\s+/).length;
                const paragraphCount = assignment.split(/\n\n+/).filter(p => p.trim()).length;
                const hasEvidence = /\(.*\d{4}.*\)|according to|research shows|study|data|statistics/i.test(assignment);
                const hasCitations = /\[.*\]|\(.*\)/.test(assignment);
                
                let feedback = {
                    overall_impression: "",
                    strengths: [],
                    growth_areas: [],
                    reflection_prompts: [],
                    next_steps: ""
                };

                if (documentType === 'presentation') {
                    // Presentation analysis
                    const slideCount = (assignment.match(/Slide \d+:/g) || []).length;
                    
                    feedback.overall_impression = `I've analyzed your ${slideCount}-slide presentation against the rubric. While you've covered the basic structure, there are several areas that need strengthening to meet the rubric standards fully.`;
                    
                    feedback.strengths = [
                        {
                            area: "Content Organization",
                            observation: `You've organized content across ${slideCount} slides, showing planning and structure.`
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Visual Design & Content Balance",
                            guiding_question: `Your slides appear text-heavy based on the content. Each slide should have 3-5 key points maximum with supporting visuals. Review each slide: can you replace paragraphs with bullet points and diagrams?`,
                            encouragement: "Create visual hierarchy: use larger fonts for headers, add relevant images or charts, and move detailed text to speaker notes."
                        },
                        {
                            rubric_criterion: "Evidence & Research",
                            guiding_question: hasEvidence ? "While you've included some data, ensure each major claim has a source citation visible on the slide." : "Your presentation lacks concrete evidence and research. Where are your statistics, expert quotes, or case studies to support your points?",
                            encouragement: "Add 3-5 credible sources throughout your presentation with proper citations on the slides where data appears."
                        }
                    ];
                    
                } else if (documentType === 'spreadsheet') {
                    // Spreadsheet analysis
                    const hasFormulas = /SUM|AVERAGE|COUNT|IF|VLOOKUP/i.test(assignment);
                    const hasSheets = /Sheet:/g.test(assignment);
                    
                    feedback.overall_impression = `I've reviewed your spreadsheet. While you've entered data, there are critical gaps in calculations, visualization, and professional formatting that need addressing.`;
                    
                    feedback.strengths = [
                        {
                            area: "Data Entry",
                            observation: hasSheets ? "You've organized data across multiple sheets, showing organizational thinking." : "You've started entering data into your spreadsheet."
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Formulas & Calculations (Critical Gap)",
                            guiding_question: hasFormulas ? "I see some formulas, but verify all calculations use formulas rather than manual entry. Check: are you using SUM for totals, AVERAGE for means, and appropriate functions for all computations?" : "I don't see evidence of formulas in your spreadsheet. You must use Excel functions (SUM, AVERAGE, IF, etc.) for all calculations, not manual entry. Which metrics need to be calculated?",
                            encouragement: "Replace every manual calculation with a formula. Use cell references so values update automatically."
                        },
                        {
                            rubric_criterion: "Data Visualization & Analysis",
                            guiding_question: "Where are your charts and graphs? Raw numbers alone don't show trends or patterns. What 2-3 charts would make your key findings immediately visible?",
                            encouragement: "Create bar/line/pie charts for your most important data. Add a summary sheet that interprets what the numbers mean."
                        }
                    ];
                    
                } else {
                    // Essay/written work analysis
                    feedback.overall_impression = `I've reviewed your ${wordCount}-word submission with ${paragraphCount} paragraphs. While you've addressed the topic, there are significant gaps in meeting the rubric criteria that need attention.`;
                    
                    feedback.strengths = [
                        {
                            area: "Basic Structure",
                            observation: paragraphCount >= 3 ? `You've organized your work into ${paragraphCount} paragraphs with introduction and conclusion.` : "You've attempted to structure your work."
                        }
                    ];
                    
                    feedback.growth_areas = [
                        {
                            rubric_criterion: "Evidence & Support (Major Gap)",
                            guiding_question: hasEvidence ? "While you've included some evidence, each major claim needs direct support. Go paragraph by paragraph: does every assertion have a citation, example, or data point?" : "Your work lacks concrete evidence. You're making claims without backing them up. Which credible sources could you cite to support each main point?",
                            encouragement: "Add at least 3-5 pieces of specific evidence (quotes, statistics, examples) from credible sources. Cite them properly."
                        },
                        {
                            rubric_criterion: "Depth of Analysis",
                            guiding_question: "Are you analyzing or just summarizing? After presenting information, do you explain WHY it matters and what it MEANS for your argument? Where can you add deeper interpretation?",
                            encouragement: "After each piece of evidence, add 2-3 sentences explaining its significance and connecting it to your thesis."
                        },
                        {
                            rubric_criterion: "Organization & Flow",
                            guiding_question: wordCount < 300 ? "Your work is quite brief. Does it fully address all rubric criteria? Which sections need expansion?" : "Review your transitions between ideas. Does each paragraph connect logically to the next? Are topic sentences clear?",
                            encouragement: "Create an outline of your current structure. If it doesn't flow logically, reorganize paragraphs for better coherence."
                        }
                    ];

                    // Add grammar and vocabulary analysis for essays
                    // Perform detailed text analysis with paragraph tracking
                    const grammarIssues = [];
                    const vocabularySuggestions = [];
                    
                    // Split text into paragraphs for location tracking
                    const paragraphs = assignment.split(/\n\n+/).filter(p => p.trim().length > 0);
                    
                    // Extract sentences for analysis
                    const sentencesForAnalysis = assignment.split(/[.!?]+/).filter(s => s.trim().length > 10);
                    
                    // Helper function to find paragraph number for a text snippet
                    const findParagraphLocation = (snippet) => {
                        for (let i = 0; i < paragraphs.length; i++) {
                            if (paragraphs[i].includes(snippet)) {
                                return i + 1;
                            }
                        }
                        return null;
                    };
                    
                    // Check for common grammar issues with specific examples
                    // 1. Subject-verb agreement issues
                    const svAgreementPattern = /\b(he|she|it|this|that|everyone|someone|nobody|each|every)\s+(are|were|have|do)\b/gi;
                    let svMatches = [];
                    let match;
                    const svRegex = new RegExp(svAgreementPattern);
                    let searchText = assignment;
                    while ((match = svRegex.exec(searchText)) !== null) {
                        // Get surrounding context (up to 80 chars)
                        const start = Math.max(0, match.index - 30);
                        const end = Math.min(searchText.length, match.index + match[0].length + 50);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        svMatches.push({ text: match[0], context, paraNum });
                        if (svMatches.length >= 3) break; // Limit to first 3 examples
                    }
                    
                    if (svMatches.length > 0) {
                        const firstExample = svMatches[0];
                        const correctForm = firstExample.text.replace(/\b(are|were|have|do)\b/i, match => {
                            const corrections = { 'are': 'is', 'were': 'was', 'have': 'has', 'do': 'does' };
                            return corrections[match.toLowerCase()] || match;
                        });
                        
                        grammarIssues.push({
                            issue: `Subject-verb agreement error: "${firstExample.text}"`,
                            correction: `Change to: "${correctForm}"`,
                            location: `Paragraph ${firstExample.paraNum || '?'}${svMatches.length > 1 ? ` (and ${svMatches.length - 1} more instance${svMatches.length > 2 ? 's' : ''})` : ''}`,
                            context: `"...${firstExample.context}..."`,
                            explanation: "Subject-verb agreement is a fundamental grammar rule. Errors here signal carelessness and reduce reader trust in your analysis",
                            impact: "HIGH - This error immediately marks your work as unpolished and can lower your grade by 5-10%. Readers may question the quality of your research if you can't master basic grammar",
                            rubric_impact: "Directly affects 'Writing Quality' or 'Mechanics' criteria on most rubrics"
                        });
                    }
                    
                    // 2. Run-on sentences (very long sentences without proper punctuation)
                    const longSentences = sentencesForAnalysis.filter(s => {
                        const words = s.trim().split(/\s+/).length;
                        const hasCommas = (s.match(/,/g) || []).length;
                        const hasSemicolons = (s.match(/;/g) || []).length;
                        return words > 35 && hasCommas < 2 && hasSemicolons === 0;
                    });
                    
                    if (longSentences.length > 0) {
                        const example = longSentences[0].trim();
                        const excerpt = example.substring(0, 120) + (example.length > 120 ? '...' : '');
                        const wordCount = example.split(/\s+/).length;
                        const paraNum = findParagraphLocation(example.substring(0, 50));
                        
                        grammarIssues.push({
                            issue: `Run-on sentence (${wordCount} words without breaks)`,
                            correction: `Break into 2-3 sentences. Add periods or semicolons. Example: Split after main clause, then start new sentence with transitional word.`,
                            location: `Paragraph ${paraNum || '?'}${longSentences.length > 1 ? ` (found ${longSentences.length} overly long sentences total)` : ''}`,
                            context: `"${excerpt}"`,
                            explanation: "Sentences over 35 words without punctuation are difficult to follow. Readers lose track of your main point and may have to re-read multiple times",
                            impact: "MEDIUM-HIGH - Reduces clarity score by 10-15%. Your argument gets lost in convoluted syntax. Break these up to improve comprehension and show control over sentence structure",
                            rubric_impact: "Affects 'Organization', 'Clarity', and 'Communication' rubric categories"
                        });
                    }
                    
                    // 3. Missing commas after introductory phrases
                    const introductoryPhrasePattern = /(However|Therefore|Furthermore|Additionally|Moreover|Consequently|Meanwhile|Nevertheless|Thus|Indeed|In fact|For example|In conclusion)\s+[a-z]/g;
                    const introMatches = [];
                    const introRegex = new RegExp(introductoryPhrasePattern);
                    searchText = assignment;
                    while ((match = introRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 10);
                        const end = Math.min(searchText.length, match.index + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        introMatches.push({ text: match[0], context, paraNum });
                        if (introMatches.length >= 3) break;
                    }
                    
                    if (introMatches.length > 0) {
                        const firstExample = introMatches[0];
                        const corrected = firstExample.text.replace(/(\w+)\s+/, '$1, ');
                        
                        grammarIssues.push({
                            issue: `Missing comma after transitional word: "${firstExample.text.trim()}"`,
                            correction: `Add comma: "${corrected}"`,
                            location: `Paragraph ${firstExample.paraNum || '?'}${introMatches.length > 1 ? ` (${introMatches.length} instances found)` : ''}`,
                            context: `"${firstExample.context}"`,
                            explanation: "Commas after introductory transitions are standard in academic writing. Missing them looks informal or rushed",
                            impact: "LOW-MEDIUM - Each instance is minor, but ${introMatches.length} errors accumulate. Together they reduce your Mechanics score by 3-5%. Easy fix with high return",
                            rubric_impact: "Affects 'Conventions', 'Mechanics', or 'Grammar' rubric sections"
                        });
                    }
                    
                    // 4. Passive voice detection with specific examples
                    const passivePattern = /\b(is|are|was|were|be|been|being)\s+(\w+ed|written|taken|given|made|done|seen|known)\b/gi;
                    const passiveMatches = [];
                    const passiveRegex = new RegExp(passivePattern);
                    searchText = assignment;
                    while ((match = passiveRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 20);
                        const end = Math.min(searchText.length, match.index + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        passiveMatches.push({ text: match[0], context, paraNum });
                        if (passiveMatches.length >= 4) break;
                    }
                    
                    if (passiveMatches.length > 3) {
                        const example = passiveMatches[0];
                        
                        grammarIssues.push({
                            issue: `Excessive passive voice (${passiveMatches.length} instances): "${example.text}"`,
                            correction: `Make active: Identify WHO does the action and make them the subject. Example: "The study was conducted by researchers" → "Researchers conducted the study"`,
                            location: `Throughout text, including paragraph ${example.paraNum || '?'}`,
                            context: `"...${example.context}..."`,
                            explanation: "Passive voice obscures responsibility and weakens your argument. Active voice is more direct, engaging, and persuasive",
                            impact: "MEDIUM - Overuse of passive voice can reduce your 'Writing Quality' score by 8-12%. Active voice makes you sound more authoritative and confident in your claims",
                            rubric_impact: "Impacts 'Style', 'Voice', 'Persuasiveness', and 'Writing Quality' criteria"
                        });
                    }
                    
                    // 5. Comma splices
                    const commaSplicePattern = /[a-z]\s*,\s*(however|therefore|moreover|furthermore|thus|nevertheless|consequently)\s*,/gi;
                    const spliceMatches = [];
                    const spliceRegex = new RegExp(commaSplicePattern);
                    searchText = assignment;
                    while ((match = spliceRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 30);
                        const end = Math.min(searchText.length, match.index + 70);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        spliceMatches.push({ text: match[0], context, paraNum });
                        if (spliceMatches.length >= 2) break;
                    }
                    
                    if (spliceMatches.length > 0) {
                        const example = spliceMatches[0];
                        grammarIssues.push({
                            issue: `Comma splice detected: "${example.text}"`,
                            correction: `Use semicolon before the transitional word: "...; however, ..." OR start new sentence: "... . However, ..."`,
                            location: `Paragraph ${example.paraNum || '?'}${spliceMatches.length > 1 ? ` (${spliceMatches.length} found)` : ''}`,
                            context: `"...${example.context}..."`,
                            explanation: "Comma splices join independent clauses incorrectly. This is a serious grammatical error in academic writing",
                            impact: "HIGH - Comma splices are considered major errors. Can reduce grade by 5-8%. Shows lack of understanding of sentence boundaries",
                            rubric_impact: "Directly penalized in 'Grammar' and 'Sentence Structure' rubric areas"
                        });
                    }
                    
                    // If no specific issues found, add general guidance
                    if (grammarIssues.length === 0) {
                        grammarIssues.push({
                            issue: "No major grammatical errors detected in automated scan",
                            correction: "Continue proofreading carefully. Consider reading aloud to catch subtle errors",
                            location: "Overall text analysis",
                            context: "Your grammar appears solid based on pattern detection",
                            explanation: "While no obvious errors were found, automated tools can miss context-dependent issues",
                            impact: "POSITIVE - Strong grammar foundation allows readers to focus on your ideas rather than errors. Maintain this quality through careful revision",
                            rubric_impact: "Maximizes points in 'Mechanics' and 'Grammar' sections"
                        });
                    }
                    
                    // VOCABULARY ANALYSIS - Find weak words with specific context
                    
                    // 1. Check for "good" and variants with exact locations
                    const goodPattern = /\b(good|great|nice|okay|ok|fine)\b/gi;
                    const goodMatches = [];
                    const goodRegex = new RegExp(goodPattern);
                    searchText = assignment;
                    while ((match = goodRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 40);
                        const end = Math.min(searchText.length, match.index + match[0].length + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        goodMatches.push({ word: match[0], context, paraNum });
                        if (goodMatches.length >= 3) break;
                    }
                    
                    if (goodMatches.length > 0) {
                        const totalCount = (assignment.match(goodPattern) || []).length;
                        const firstUse = goodMatches[0];
                        const locations = goodMatches.map(m => `¶${m.paraNum || '?'}`).join(', ');
                        
                        vocabularySuggestions.push({
                            original_word: firstUse.word.toLowerCase(),
                            occurrences: totalCount,
                            location: `Paragraphs: ${locations}${totalCount > goodMatches.length ? ` (${totalCount - goodMatches.length} more)` : ''}`,
                            context: `"...${firstUse.context}..."`,
                            suggestions: ["effective", "compelling", "robust", "substantial", "beneficial", "advantageous"],
                            explanation: "Words like 'good' are vague and subjective. Academic writing requires precise, analytical language that shows critical thinking",
                            impact: `MEDIUM-HIGH - Using '${firstUse.word}' ${totalCount} time${totalCount > 1 ? 's' : ''} weakens your analytical voice. Replacing with specific descriptors can improve your 'Vocabulary' score by 8-12% and make arguments more persuasive`,
                            rubric_impact: "Affects 'Word Choice', 'Vocabulary', 'Academic Style' rubric criteria",
                            specific_improvement: `In paragraph ${firstUse.paraNum || '?'}, instead of "${firstUse.context.substring(0, 60)}...", use a precise term that explains WHY it's good`
                        });
                    }
                    
                    // 2. Check for "bad" and variants
                    const badPattern = /\b(bad|wrong|terrible|awful|poor)\b/gi;
                    const badMatches = [];
                    const badRegex = new RegExp(badPattern);
                    searchText = assignment;
                    while ((match = badRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 40);
                        const end = Math.min(searchText.length, match.index + match[0].length + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        badMatches.push({ word: match[0], context, paraNum });
                        if (badMatches.length >= 3) break;
                    }
                    
                    if (badMatches.length > 0) {
                        const totalCount = (assignment.match(badPattern) || []).length;
                        const firstUse = badMatches[0];
                        const locations = badMatches.map(m => `¶${m.paraNum || '?'}`).join(', ');
                        
                        vocabularySuggestions.push({
                            original_word: firstUse.word.toLowerCase(),
                            occurrences: totalCount,
                            location: `Paragraphs: ${locations}${totalCount > badMatches.length ? ` (${totalCount - badMatches.length} more)` : ''}`,
                            context: `"...${firstUse.context}..."`,
                            suggestions: ["detrimental", "problematic", "counterproductive", "ineffective", "flawed", "inadequate"],
                            explanation: "Generic negative words lack analytical precision. Specify exactly what type of negative quality you're identifying",
                            impact: `MEDIUM - Using '${firstUse.word}' ${totalCount} time${totalCount > 1 ? 's' : ''} sounds informal and imprecise. Upgrading to academic alternatives can boost 'Vocabulary' and 'Critical Analysis' scores by 6-10%`,
                            rubric_impact: "Impacts 'Word Choice', 'Analytical Depth', 'Academic Tone'",
                            specific_improvement: `In ¶${firstUse.paraNum || '?'}, replace with a term that specifies the TYPE of problem (ethical? practical? methodological?)`
                        });
                    }
                    
                    // 3. Check for "things/stuff"
                    const vaguePattern = /\b(things|stuff)\b/gi;
                    const vagueMatches = [];
                    const vagueRegex = new RegExp(vaguePattern);
                    searchText = assignment;
                    while ((match = vagueRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 40);
                        const end = Math.min(searchText.length, match.index + match[0].length + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        vagueMatches.push({ word: match[0], context, paraNum });
                        if (vagueMatches.length >= 3) break;
                    }
                    
                    if (vagueMatches.length > 0) {
                        const totalCount = (assignment.match(vaguePattern) || []).length;
                        const firstUse = vagueMatches[0];
                        const locations = vagueMatches.map(m => `¶${m.paraNum || '?'}`).join(', ');
                        
                        vocabularySuggestions.push({
                            original_word: firstUse.word.toLowerCase(),
                            occurrences: totalCount,
                            location: `Paragraphs: ${locations}${totalCount > vagueMatches.length ? ` (${totalCount - vagueMatches.length} more)` : ''}`,
                            context: `"...${firstUse.context}..."`,
                            suggestions: ["factors", "elements", "components", "aspects", "variables", "considerations"],
                            explanation: "'Things' and 'stuff' are placeholder words that signal unclear thinking. Replace with specific nouns that name exactly what you mean",
                            impact: `HIGH - Using '${firstUse.word}' ${totalCount} time${totalCount > 1 ? 's' : ''} is a major red flag in academic writing. This single issue can lower your grade by 10-15% as it suggests you haven't thought through your topic deeply`,
                            rubric_impact: "Severely impacts 'Precision', 'Vocabulary', 'Academic Writing' scores",
                            specific_improvement: `In ¶${firstUse.paraNum || '?'}, identify the EXACT noun: Are they factors? Methods? Outcomes? Challenges? Be specific!`
                        });
                    }
                    
                    // 4. Check for "very" and intensifier overuse
                    const intensifierPattern = /\b(very|really|quite|extremely|incredibly)\s+(\w+)/gi;
                    const intensifierMatches = [];
                    const intensifierRegex = new RegExp(intensifierPattern);
                    searchText = assignment;
                    while ((match = intensifierRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 40);
                        const end = Math.min(searchText.length, match.index + match[0].length + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        intensifierMatches.push({ word: match[0], context, paraNum });
                        if (intensifierMatches.length >= 3) break;
                    }
                    
                    if (intensifierMatches.length > 2) {
                        const totalCount = (assignment.match(/\b(very|really|quite)\b/gi) || []).length;
                        const firstUse = intensifierMatches[0];
                        const locations = intensifierMatches.slice(0, 3).map(m => `¶${m.paraNum || '?'}`).join(', ');
                        
                        vocabularySuggestions.push({
                            original_word: firstUse.word.split(' ')[0].toLowerCase(),
                            occurrences: totalCount,
                            location: `Paragraphs: ${locations}${totalCount > 3 ? ` (+${totalCount - 3} more)` : ''}`,
                            context: `"...${firstUse.context}..."`,
                            suggestions: ["(Use stronger base word instead)", "significant", "considerable", "substantial", "remarkable"],
                            explanation: "Intensifiers like 'very' weaken writing. Instead of 'very good', use 'excellent'. Instead of 'very bad', use 'terrible'. One strong word beats two weak ones",
                            impact: `MEDIUM - ${totalCount} instances of weak intensifiers reduce impact. Removing them and using stronger adjectives improves 'Conciseness' and 'Word Choice' scores by 5-8%`,
                            rubric_impact: "Affects 'Precision', 'Conciseness', 'Word Choice'",
                            specific_improvement: `In ¶${firstUse.paraNum || '?'}, delete 'very/really' and find a single, stronger word that captures the full meaning`
                        });
                    }
                    
                    // 5. Check for "a lot"
                    const alotPattern = /\ba lot\b/gi;
                    const alotMatches = [];
                    const alotRegex = new RegExp(alotPattern);
                    searchText = assignment;
                    while ((match = alotRegex.exec(searchText)) !== null) {
                        const start = Math.max(0, match.index - 40);
                        const end = Math.min(searchText.length, match.index + match[0].length + 60);
                        const context = searchText.substring(start, end).trim();
                        const paraNum = findParagraphLocation(match[0]);
                        alotMatches.push({ context, paraNum });
                        if (alotMatches.length >= 2) break;
                    }
                    
                    if (alotMatches.length > 0) {
                        const totalCount = (assignment.match(alotPattern) || []).length;
                        const firstUse = alotMatches[0];
                        const locations = alotMatches.map(m => `¶${m.paraNum || '?'}`).join(', ');
                        
                        vocabularySuggestions.push({
                            original_word: "a lot",
                            occurrences: totalCount,
                            location: `Paragraphs: ${locations}${totalCount > alotMatches.length ? ` (${totalCount - alotMatches.length} more)` : ''}`,
                            context: `"...${firstUse.context}..."`,
                            suggestions: ["numerous", "substantial", "significant", "considerable", "extensive", "abundant"],
                            explanation: "'A lot' is conversational and imprecise. Academic writing needs specific quantification",
                            impact: `MEDIUM - ${totalCount} instance${totalCount > 1 ? 's' : ''} of 'a lot' marks your work as informal. Replacing with academic terms improves 'Formality' score by 6-9% and shows maturity`,
                            rubric_impact: "Affects 'Academic Tone', 'Formality', 'Precision'",
                            specific_improvement: `In ¶${firstUse.paraNum || '?'}, either use a precise number/percentage OR choose an academic quantifier from the suggestions`
                        });
                    }
                    
                    // If no weak vocabulary found, acknowledge strength
                    if (vocabularySuggestions.length === 0) {
                        vocabularySuggestions.push({
                            original_word: "N/A",
                            occurrences: 0,
                            location: "Overall text",
                            context: "Vocabulary analysis shows appropriate academic register throughout",
                            suggestions: ["Continue using precise, discipline-specific terminology"],
                            explanation: "Your word choices demonstrate sophistication and subject mastery. This is exactly what strong academic writing looks like",
                            impact: "POSITIVE - Strong vocabulary maximizes 'Word Choice' and 'Academic Style' rubric points. You're likely earning 90%+ in these categories. Keep this standard!",
                            rubric_impact: "Earning high marks in 'Vocabulary', 'Precision', 'Academic Tone'",
                            specific_improvement: "No changes needed - your vocabulary strength is supporting your argument effectively"
                        });
                    }
                    
                    feedback.grammar_and_vocabulary = {
                        grammar_issues: grammarIssues,
                        vocabulary_suggestions: vocabularySuggestions
                    };

                    // Add AI detection analysis for essays
                    // Analyze patterns that might indicate AI or human writing
                    const sentences = assignment.split(/[.!?]+/).filter(s => s.trim().length > 0);
                    const avgSentenceLength = sentences.reduce((sum, s) => sum + s.trim().split(/\s+/).length, 0) / sentences.length;
                    const hasPersonalAnecdotes = /\b(I|my|me|we|our|us)\b/i.test(assignment);
                    const hasVaryingSentenceLength = sentences.some(s => s.trim().split(/\s+/).length < 10) && sentences.some(s => s.trim().split(/\s+/).length > 25);
                    const hasContractions = /\b(don't|can't|won't|isn't|aren't|wasn't|weren't|haven't|hasn't|wouldn't|shouldn't|couldn't)\b/i.test(assignment);
                    const hasComplexVocabulary = /\b(nonetheless|furthermore|consequently|moreover|therefore|subsequently|essentially|fundamentally)\b/i.test(assignment);
                    const hasPerfectGrammar = !(/\b(alot|irregardless|should of|could of|would of)\b/i.test(assignment));
                    
                    // Calculate likelihood score
                    let aiScore = 50; // Start neutral
                    
                    // Human indicators (reduce score)
                    if (hasPersonalAnecdotes) aiScore -= 15;
                    if (hasVaryingSentenceLength) aiScore -= 10;
                    if (hasContractions) aiScore -= 10;
                    if (!hasPerfectGrammar) aiScore -= 10; // Minor errors suggest human
                    
                    // AI indicators (increase score)
                    if (avgSentenceLength > 20 && avgSentenceLength < 25) aiScore += 10; // AI tends to be consistent
                    if (hasComplexVocabulary && !hasContractions) aiScore += 10;
                    if (hasPerfectGrammar && wordCount > 500) aiScore += 10;
                    if (!hasPersonalAnecdotes && wordCount > 300) aiScore += 5;
                    
                    // Clamp between 0-100
                    aiScore = Math.max(0, Math.min(100, aiScore));
                    
                    let confidenceLevel = "Low";
                    if (aiScore > 70 || aiScore < 30) confidenceLevel = "High";
                    else if (aiScore > 60 || aiScore < 40) confidenceLevel = "Medium";
                    
                    const humanElements = [];
                    const aiElements = [];
                    
                    if (hasPersonalAnecdotes) humanElements.push("Uses first-person perspective and personal experiences");
                    if (hasVaryingSentenceLength) humanElements.push("Varied sentence structure and length");
                    if (hasContractions) humanElements.push("Informal language and contractions present");
                    if (!hasPerfectGrammar) humanElements.push("Natural minor grammatical variations");
                    
                    if (avgSentenceLength > 20 && avgSentenceLength < 25) aiElements.push("Very consistent sentence length (average: " + Math.round(avgSentenceLength) + " words)");
                    if (hasComplexVocabulary && !hasContractions) aiElements.push("Formal academic vocabulary without informal elements");
                    if (hasPerfectGrammar && wordCount > 500) aiElements.push("Unusually consistent grammar for extended writing");
                    if (!hasPersonalAnecdotes && wordCount > 300) aiElements.push("Lacks personal voice or anecdotes");
                    
                    if (humanElements.length === 0) humanElements.push("Limited personal or informal elements detected");
                    if (aiElements.length === 0) aiElements.push("Writing patterns appear authentic");
                    
                    feedback.ai_detection = {
                        likelihood_score: aiScore,
                        confidence_level: confidenceLevel,
                        analysis: aiScore > 60 
                            ? "The writing shows some patterns commonly associated with AI-generated text, though this is not definitive." 
                            : aiScore < 40
                            ? "The writing displays characteristics typical of authentic human composition."
                            : "The writing shows a mix of human and AI-like characteristics, making a definitive assessment difficult.",
                        indicators: [
                            {
                                pattern: `Sentence consistency: ${hasVaryingSentenceLength ? 'Varied' : 'Uniform'} structure`,
                                explanation: hasVaryingSentenceLength ? "Natural variation in sentence length suggests human writing" : "Consistent sentence patterns can indicate AI generation",
                                weight: hasVaryingSentenceLength ? "moderate" : "moderate"
                            },
                            {
                                pattern: `Personal voice: ${hasPersonalAnecdotes ? 'Present' : 'Absent'}`,
                                explanation: hasPersonalAnecdotes ? "First-person perspective and personal experiences indicate human authorship" : "Lack of personal elements may suggest AI-generated content",
                                weight: hasPersonalAnecdotes ? "strong" : "moderate"
                            },
                            {
                                pattern: `Language formality: ${hasContractions ? 'Mixed formal/informal' : 'Consistently formal'}`,
                                explanation: hasContractions ? "Use of contractions suggests natural human writing" : "Strictly formal language throughout is common in AI text",
                                weight: hasContractions ? "moderate" : "weak"
                            }
                        ],
                        human_elements: humanElements,
                        ai_elements: aiElements,
                        recommendation: aiScore > 70 
                            ? "This submission shows several indicators commonly associated with AI-generated content. Consider discussing the work with the student to understand their writing process."
                            : aiScore > 55
                            ? "While some AI-like patterns are present, the evidence is not conclusive. The writing may be original with formal style preferences."
                            : "The writing demonstrates authentic human characteristics. Any AI-like patterns are likely coincidental or due to formal writing style."
                    };
                }

                // Common reflection prompts
                feedback.reflection_prompts = [
                    "Which specific rubric criterion am I weakest in, and what concrete evidence shows this gap?",
                    "If I had to explain my main argument/findings to someone unfamiliar with the topic, what would I say?",
                    "What's the single most important improvement I could make that would have the biggest impact on my grade?",
                    "Am I actually answering the assignment prompt, or have I drifted to a related but different topic?",
                    "If I score myself honestly against each rubric criterion, where do I fall short and why?"
                ];

                // Document-specific next steps
                if (documentType === 'presentation') {
                    feedback.next_steps = "Action plan: (1) Reduce text on each slide by 50% - aim for 3-5 bullets max. (2) Add 3-5 relevant visuals (images, charts, diagrams). (3) Create section divider slides. (4) Add source citations on data slides. (5) Write compelling opening and closing slides. (6) Move detailed content to speaker notes.";
                } else if (documentType === 'spreadsheet') {
                    feedback.next_steps = "Action plan: (1) Verify all data is complete and accurate. (2) Replace manual calculations with formulas. (3) Create 2-3 charts showing key findings. (4) Add professional formatting: headers, borders, colors. (5) Create a summary sheet explaining findings. (6) Test formulas by changing values.";
                } else {
                    feedback.next_steps = "Action plan: (1) Score yourself honestly on each rubric criterion. (2) Identify your 2-3 biggest gaps. (3) Find 3-5 pieces of concrete evidence to add. (4) After each evidence piece, add analysis explaining significance. (5) Reorganize paragraphs for logical flow. (6) Strengthen introduction and conclusion.";
                }

                return feedback;
            };

            const canAnalyze = rubric.trim().length > 0 && assignment.trim().length > 0;

            return (
                <div className="min-h-screen" style={{background: 'linear-gradient(to bottom, #42047e, #07f49e)'}}>
                    {/* Hero Section */}
                    <div className="relative overflow-hidden">
                        <div className="absolute inset-0 bg-[#1e3a5f] opacity-[0.02]"></div>
                        <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-12">
                            <div className="text-center max-w-3xl mx-auto">
                                <h1 className="text-5xl sm:text-6xl font-bold text-white tracking-tight mb-3">
                                    The Teachers Desk
                                </h1>
                                <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 text-white text-sm font-medium mb-6">
                                    <Sparkles />
                                    Supportive Learning Assistant
                                </div>
                                <h2 className="text-3xl sm:text-4xl font-bold text-white tracking-tight mb-4">
                                    Grow Your Work,
                                    <span className="block text-[#07f49e]">Your Way</span>
                                </h2>
                                <p className="text-lg text-white/90 leading-relaxed">
                                    Get thoughtful guidance on your assignments without compromising your learning. 
                                    We help you discover improvements yourself—no answers, just support.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Features */}
                    <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 -mt-4 mb-12">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div className="flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                                <div className="w-12 h-12 rounded-xl bg-[#f97316]/10 flex items-center justify-center flex-shrink-0">
                                    <BookOpen />
                                </div>
                                <div>
                                    <h3 className="font-semibold text-[#1e3a5f]">Rubric-Aligned</h3>
                                    <p className="text-sm text-slate-500">Feedback based on your specific criteria</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                                <div className="w-12 h-12 rounded-xl bg-[#f97316]/10 flex items-center justify-center flex-shrink-0">
                                    <Target />
                                </div>
                                <div>
                                    <h3 className="font-semibold text-[#1e3a5f]">Growth-Focused</h3>
                                    <p className="text-sm text-slate-500">Identifies areas for improvement</p>
                                </div>
                            </div>
                        </div>
                        <div className="p-5 rounded-2xl bg-white border border-slate-100 shadow-sm">
                            <div className="flex items-start gap-4">
                                <div className="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center flex-shrink-0 mt-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 16v-4"/>
                                        <path d="M12 8h.01"/>
                                    </svg>
                                </div>
                                <div className="flex-1">
                                    <h3 className="font-semibold text-[#1e3a5f] mb-2">Using Google Docs, Sheets, or Slides?</h3>
                                    <p className="text-sm text-slate-600 mb-3">
                                        Google files can't be uploaded directly from your computer since they're stored in the cloud. 
                                        To use them with The Teachers Desk, you'll need to download or export them first:
                                    </p>
                                    <div className="space-y-2 text-sm text-slate-700">
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">1.</span>
                                            <p>Open your Google Doc, Sheet, or Slide</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">2.</span>
                                            <p>Click <strong>File</strong> in the top menu</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">3.</span>
                                            <p>Select <strong>Download</strong> and choose your preferred format:</p>
                                        </div>
                                        <div className="ml-7 space-y-1.5 text-xs bg-slate-50 p-3 rounded-lg border border-slate-200">
                                            <p>• <strong>Google Docs</strong> → Download as PDF (.pdf) or Word (.docx)</p>
                                            <p>• <strong>Google Sheets</strong> → Download as Excel (.xlsx)</p>
                                            <p>• <strong>Google Slides</strong> → Download as PDF (.pdf) or PowerPoint (.pptx)</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <span className="font-semibold text-blue-600 mt-0.5">4.</span>
                                            <p>Upload the downloaded file using the upload buttons above</p>
                                        </div>
                                    </div>
                                    <p className="text-xs text-slate-500 mt-3 italic">
                                        💡 Tip: PDF format works best for preserving your formatting!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
                        {/* Input Section - Horizontal at Top */}
                        <div className="mb-8">
                            <div className="border-0 shadow-lg shadow-slate-200/50 overflow-hidden rounded-lg bg-white">
                                <div className="bg-gradient-to-r from-[#1e3a5f] to-[#2d4a6f] text-white p-6">
                                    <h3 className="text-xl font-semibold mb-2">Submit Your Work</h3>
                                    <p className="text-slate-300 text-sm">
                                        Paste your rubric and assignment to receive supportive feedback
                                    </p>
                                </div>
                                
                                {/* Horizontal Grid for Rubric and Assignment */}
                                <div className="p-6">
                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                        {/* Rubric Section */}
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <FileText />
                                                    <label className="text-sm font-medium text-slate-700">
                                                        Assignment Rubric
                                                    </label>
                                                </div>
                                                <div className="relative">
                                                    <input
                                                        type="file"
                                                        accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt"
                                                        onChange={(e) => e.target.files[0] && handleFileUpload(e.target.files[0], 'rubric')}
                                                        className="hidden"
                                                        id="rubric-upload"
                                                    />
                                                    <button
                                                        onClick={() => document.getElementById('rubric-upload').click()}
                                                        className="text-xs px-3 py-1.5 border border-slate-300 rounded-md hover:bg-slate-50 flex items-center gap-1"
                                                    >
                                                        <Upload />
                                                        Upload File
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            {rubricFile && (
                                                <div className="flex items-center gap-2 p-2 bg-[#1e3a5f]/5 rounded-lg">
                                                    <FileText />
                                                    <span className="text-xs text-slate-600 flex-1 truncate">{rubricFile.name}</span>
                                                    <button
                                                        className="h-6 w-6 hover:bg-slate-200 rounded flex items-center justify-center"
                                                        onClick={() => removeFile('rubric')}
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            )}

                                            {/* Preview for PowerPoint Rubric */}
                                            {rubricPreview && rubricPreview.type === 'presentation' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg border border-orange-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-orange-600">
                                                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-orange-900">Presentation Preview</span>
                                                        <span className="text-xs text-orange-700 ml-auto">{rubricPreview.slideCount} slides</span>
                                                    </div>
                                                    <div className="space-y-2">
                                                        {rubricPreview.slides.map((slide, idx) => (
                                                            <div key={idx} className="bg-white p-3 rounded border border-orange-200 shadow-sm">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="text-xs font-bold text-orange-600">Slide {slide.number}</span>
                                                                </div>
                                                                <p className="text-xs text-slate-700 line-clamp-2">{slide.text || 'No text content'}</p>
                                                            </div>
                                                        ))}
                                                        {rubricPreview.slideCount > 3 && (
                                                            <p className="text-xs text-orange-600 text-center italic mt-2">
                                                                + {rubricPreview.slideCount - 3} more slides
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Preview for Spreadsheet Rubric */}
                                            {rubricPreview && rubricPreview.type === 'spreadsheet' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600">
                                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                            <line x1="3" y1="9" x2="21" y2="9"/>
                                                            <line x1="3" y1="15" x2="21" y2="15"/>
                                                            <line x1="9" y1="3" x2="9" y2="21"/>
                                                            <line x1="15" y1="3" x2="15" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-green-900">Spreadsheet Preview</span>
                                                        <span className="text-xs text-green-700 ml-auto">{rubricPreview.sheets.length} sheet(s)</span>
                                                    </div>
                                                    <div className="bg-white p-2 rounded border border-green-200 overflow-x-auto">
                                                        <table className="w-full text-xs border-collapse">
                                                            <tbody>
                                                                {rubricPreview.data.map((row, ridx) => (
                                                                    <tr key={ridx} className={ridx === 0 ? 'bg-green-100 font-semibold' : ''}>
                                                                        {row.map((cell, cidx) => (
                                                                            <td key={cidx} className="border border-green-200 px-2 py-1 text-slate-700">
                                                                                {String(cell).substring(0, 20)}{String(cell).length > 20 ? '...' : ''}
                                                                            </td>
                                                                        ))}
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <p className="text-xs text-green-600 text-center italic mt-2">
                                                        Showing first {rubricPreview.rows} rows × {rubricPreview.cols} columns of "{rubricPreview.sheets[0]}"
                                                    </p>
                                                </div>
                                            )}

                                            <textarea
                                                placeholder="Paste your assignment rubric here or upload a file...

Example:
• Content (40%): Demonstrates understanding of key concepts
• Organization (25%): Clear structure with logical flow
• Evidence (20%): Supports claims with relevant examples
• Mechanics (15%): Proper grammar and formatting"
                                                value={rubric}
                                                onChange={(e) => setRubric(e.target.value)}
                                                className="w-full min-h-[200px] resize-none border border-slate-200 focus:border-[#f97316] focus:ring-2 focus:ring-[#f97316]/20 rounded-xl text-sm p-3 outline-none"
                                            />
                                            <span className="text-xs text-slate-400">
                                                {rubric.length > 0 ? `${rubric.length} characters` : 'Paste text or upload PDF, Word, Excel, or text file'}
                                            </span>
                                        </div>

                                        {/* Divider */}
                                        <div className="relative">
                                            <div className="absolute inset-0 flex items-center">
                                                <div className="w-full border-t border-slate-200"></div>
                                            </div>
                                            <div className="relative flex justify-center text-xs">
                                                <span className="bg-white px-3 text-slate-400">and</span>
                                            </div>
                                        </div>

                                        {/* Assignment Section */}
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <Upload />
                                                    <label className="text-sm font-medium text-slate-700">
                                                        Your Assignment
                                                    </label>
                                                </div>
                                                <div className="relative">
                                                    <input
                                                        type="file"
                                                        accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt"
                                                        onChange={(e) => e.target.files[0] && handleFileUpload(e.target.files[0], 'assignment')}
                                                        className="hidden"
                                                        id="assignment-upload"
                                                    />
                                                    <button
                                                        onClick={() => document.getElementById('assignment-upload').click()}
                                                        className="text-xs px-3 py-1.5 border border-slate-300 rounded-md hover:bg-slate-50 flex items-center gap-1"
                                                    >
                                                        <Upload />
                                                        Upload File
                                                    </button>
                                                </div>
                                            </div>

                                            {assignmentFile && (
                                                <div className="flex items-center gap-2 p-2 bg-[#1e3a5f]/5 rounded-lg">
                                                    <FileText />
                                                    <span className="text-xs text-slate-600 flex-1 truncate">{assignmentFile.name}</span>
                                                    <button
                                                        className="h-6 w-6 hover:bg-slate-200 rounded flex items-center justify-center"
                                                        onClick={() => removeFile('assignment')}
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            )}

                                            {/* Preview for PowerPoint */}
                                            {assignmentPreview && assignmentPreview.type === 'presentation' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg border border-orange-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-orange-600">
                                                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-orange-900">Presentation Preview</span>
                                                        <span className="text-xs text-orange-700 ml-auto">{assignmentPreview.slideCount} slides</span>
                                                    </div>
                                                    <div className="space-y-2">
                                                        {assignmentPreview.slides.map((slide, idx) => (
                                                            <div key={idx} className="bg-white p-3 rounded border border-orange-200 shadow-sm">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <span className="text-xs font-bold text-orange-600">Slide {slide.number}</span>
                                                                </div>
                                                                <p className="text-xs text-slate-700 line-clamp-2">{slide.text || 'No text content'}</p>
                                                            </div>
                                                        ))}
                                                        {assignmentPreview.slideCount > 3 && (
                                                            <p className="text-xs text-orange-600 text-center italic mt-2">
                                                                + {assignmentPreview.slideCount - 3} more slides
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Preview for Spreadsheet */}
                                            {assignmentPreview && assignmentPreview.type === 'spreadsheet' && (
                                                <div className="mt-3 p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border border-green-200">
                                                    <div className="flex items-center gap-2 mb-3">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600">
                                                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                                                            <line x1="3" y1="9" x2="21" y2="9"/>
                                                            <line x1="3" y1="15" x2="21" y2="15"/>
                                                            <line x1="9" y1="3" x2="9" y2="21"/>
                                                            <line x1="15" y1="3" x2="15" y2="21"/>
                                                        </svg>
                                                        <span className="text-sm font-semibold text-green-900">Spreadsheet Preview</span>
                                                        <span className="text-xs text-green-700 ml-auto">{assignmentPreview.sheets.length} sheet(s)</span>
                                                    </div>
                                                    <div className="bg-white p-2 rounded border border-green-200 overflow-x-auto">
                                                        <table className="w-full text-xs border-collapse">
                                                            <tbody>
                                                                {assignmentPreview.data.map((row, ridx) => (
                                                                    <tr key={ridx} className={ridx === 0 ? 'bg-green-100 font-semibold' : ''}>
                                                                        {row.map((cell, cidx) => (
                                                                            <td key={cidx} className="border border-green-200 px-2 py-1 text-slate-700">
                                                                                {String(cell).substring(0, 20)}{String(cell).length > 20 ? '...' : ''}
                                                                            </td>
                                                                        ))}
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <p className="text-xs text-green-600 text-center italic mt-2">
                                                        Showing first {assignmentPreview.rows} rows × {assignmentPreview.cols} columns of "{assignmentPreview.sheets[0]}"
                                                    </p>
                                                </div>
                                            )}

                                            <textarea
                                                placeholder="Paste your assignment, essay, or project work here or upload a file...

This is where you'll add the work you want feedback on. The more complete your submission, the more helpful the guidance will be."
                                                value={assignment}
                                                onChange={(e) => setAssignment(e.target.value)}
                                                className="w-full min-h-[200px] resize-none border border-slate-200 focus:border-[#f97316] focus:ring-2 focus:ring-[#f97316]/20 rounded-xl text-sm p-3 outline-none"
                                            />
                                            <span className="text-xs text-slate-400">
                                                {assignment.length > 0 ? `${assignment.length} characters` : 'Paste text or upload PDF, Word, Excel, or text file'}
                                            </span>
                                        </div>

                                        <button
                                            onClick={handleAnalyze}
                                            disabled={!canAnalyze || isAnalyzing}
                                            className="w-full h-12 bg-[#f97316] hover:bg-[#ea580c] text-white font-medium rounded-xl shadow-lg shadow-[#f97316]/25 transition-all duration-200 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed"
                                        >
                                            {isAnalyzing ? (
                                                <span className="flex items-center justify-center gap-2">
                                                    <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                                                    Analyzing...
                                                </span>
                                            ) : (
                                                <span className="flex items-center justify-center gap-2">
                                                    <Sparkles />
                                                    Get Supportive Feedback
                                                </span>
                                            )}
                                        </button>
                                        {!canAnalyze && (
                                            <p className="text-center text-xs text-slate-400 mt-3">
                                                Please provide both a rubric and your assignment
                                            </p>
                                        )}
                                    </div>
                                    
                                    {/* Trust Badge */}
                                    <div className="flex items-center justify-center gap-3 text-sm text-slate-600 pt-4 border-t border-slate-200">
                                        <div className="w-2 h-2 rounded-full bg-green-400"></div>
                                        <span>Your work is never stored or shared</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Feedback Section - Full Width Below */}
                        <div className="mt-8">
                            {isAnalyzing ? (
                                <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg p-12 text-center">
                                    <div className="w-16 h-16 border-4 border-[#f97316]/20 border-t-[#f97316] rounded-full animate-spin mx-auto mb-4"></div>
                                    <h3 className="text-xl font-semibold text-[#1e3a5f] mb-2">
                                        Analyzing Your Work
                                    </h3>
                                    <p className="text-slate-500">
                                        Crafting personalized feedback just for you...
                                    </p>
                                </div>
                            ) : feedback ? (
                                <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg overflow-hidden">
                                    <div className="bg-gradient-to-r from-[#f97316] to-[#ea580c] text-white p-6">
                                        <h3 className="text-xl font-semibold mb-2">Your Feedback</h3>
                                        <p className="text-sm text-white/90">Guidance to help you grow</p>
                                    </div>
                                    <div className="p-6 space-y-6">
                                            {/* Overall Impression */}
                                            <div>
                                                <p className="text-slate-700 leading-relaxed">{feedback.overall_impression}</p>
                                            </div>

                                            {/* Strengths */}
                                            <div>
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-3 flex items-center gap-2">
                                                    ✨ What You're Doing Well
                                                </h4>
                                                <div className="space-y-3">
                                                    {feedback.strengths.map((strength, i) => (
                                                        <div key={i} className="bg-green-50 border border-green-100 rounded-lg p-4">
                                                            <h5 className="font-semibold text-green-900 mb-1">{strength.area}</h5>
                                                            <p className="text-sm text-green-800">{strength.observation}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Growth Areas */}
                                            <div>
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-3 flex items-center gap-2">
                                                    🌱 Opportunities for Growth
                                                </h4>
                                                <div className="space-y-4">
                                                    {feedback.growth_areas.map((area, i) => (
                                                        <div key={i} className="bg-blue-50 border border-blue-100 rounded-lg p-4">
                                                            <h5 className="font-semibold text-blue-900 mb-2">{area.rubric_criterion}</h5>
                                                            <p className="text-sm text-blue-800 mb-2 italic">💭 {area.guiding_question}</p>
                                                            <p className="text-sm text-blue-700">{area.encouragement}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Grammar and Vocabulary Section - Only for Essays */}
                                            {feedback.grammar_and_vocabulary && (
                                                <div className="border-t border-slate-200 pt-6">
                                                    <h4 className="text-lg font-semibold text-[#1e3a5f] mb-4 flex items-center gap-2">
                                                        📝 Writing Mechanics & Style Analysis
                                                    </h4>
                                                    
                                                    {/* Grammar Issues - Infographic Style */}
                                                    <div className="mb-6">
                                                        <h5 className="text-md font-semibold text-slate-700 mb-3">Grammar & Punctuation</h5>
                                                        <div className="grid gap-4">
                                                            {feedback.grammar_and_vocabulary.grammar_issues.map((item, i) => (
                                                                <div key={i} className="bg-white border-2 border-amber-300 rounded-xl overflow-hidden shadow-lg">
                                                                    {/* Top Header Bar */}
                                                                    <div className="bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-3 flex items-center justify-between">
                                                                        <div className="flex items-center gap-3">
                                                                            <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center text-2xl">
                                                                                ⚠️
                                                                            </div>
                                                                            <div>
                                                                                <p className="text-white font-bold text-sm">{item.issue.substring(0, 50)}{item.issue.length > 50 ? '...' : ''}</p>
                                                                                {item.location && (
                                                                                    <p className="text-amber-100 text-xs">📍 {item.location}</p>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                        {item.impact && (
                                                                            <div className={`px-4 py-2 rounded-full text-xs font-black ${
                                                                                item.impact.includes('HIGH') ? 'bg-red-600 text-white' :
                                                                                item.impact.includes('MEDIUM') ? 'bg-orange-600 text-white' :
                                                                                item.impact.includes('POSITIVE') ? 'bg-green-600 text-white' :
                                                                                'bg-yellow-400 text-slate-900'
                                                                            }`}>
                                                                                {item.impact.split(' - ')[0]}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                    
                                                                    {/* Content Grid */}
                                                                    <div className="p-4 grid md:grid-cols-2 gap-4">
                                                                        {/* Left Column - Example & Fix */}
                                                                        <div className="space-y-3">
                                                                            {/* Example */}
                                                                            {item.context && (
                                                                                <div className="bg-red-50 border-l-4 border-red-400 rounded p-3">
                                                                                    <div className="flex items-center gap-2 mb-2">
                                                                                        <span className="text-red-600 text-lg">❌</span>
                                                                                        <span className="text-xs font-bold text-red-800 uppercase">Your Text</span>
                                                                                    </div>
                                                                                    <p className="text-xs text-red-900 font-mono leading-relaxed">{item.context}</p>
                                                                                </div>
                                                                            )}
                                                                            
                                                                            {/* Fix */}
                                                                            <div className="bg-green-50 border-l-4 border-green-400 rounded p-3">
                                                                                <div className="flex items-center gap-2 mb-2">
                                                                                    <span className="text-green-600 text-lg">✅</span>
                                                                                    <span className="text-xs font-bold text-green-800 uppercase">How to Fix</span>
                                                                                </div>
                                                                                <p className="text-xs text-green-900 leading-relaxed">{item.correction}</p>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        {/* Right Column - Impact Visualization */}
                                                                        <div className="space-y-3">
                                                                            {/* Impact Meter */}
                                                                            {item.impact && (
                                                                                <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                                                                    <p className="text-xs font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                                                        <span className="text-lg">📊</span>
                                                                                        GRADE IMPACT
                                                                                    </p>
                                                                                    <div className="space-y-2">
                                                                                        {/* Visual Bar */}
                                                                                        <div className="flex items-center gap-2">
                                                                                            <div className="flex-1 h-4 bg-slate-200 rounded-full overflow-hidden">
                                                                                                <div className={`h-full ${
                                                                                                    item.impact.includes('HIGH') ? 'bg-red-500 w-5/6' :
                                                                                                    item.impact.includes('MEDIUM-HIGH') ? 'bg-orange-500 w-4/6' :
                                                                                                    item.impact.includes('MEDIUM') ? 'bg-orange-400 w-3/6' :
                                                                                                    item.impact.includes('POSITIVE') ? 'bg-green-500 w-5/6' :
                                                                                                    'bg-yellow-400 w-2/6'
                                                                                                }`}></div>
                                                                                            </div>
                                                                                            <span className="text-xs font-bold text-slate-700 w-12 text-right">
                                                                                                {item.impact.includes('HIGH') ? '85%' :
                                                                                                 item.impact.includes('MEDIUM-HIGH') ? '65%' :
                                                                                                 item.impact.includes('MEDIUM') ? '50%' :
                                                                                                 item.impact.includes('POSITIVE') ? '95%' : '30%'}
                                                                                            </span>
                                                                                        </div>
                                                                                        <p className="text-xs text-slate-600 leading-snug">
                                                                                            {item.impact.split(' - ').slice(1).join(' - ')}
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                            
                                                                            {/* Rubric Impact */}
                                                                            {item.rubric_impact && (
                                                                                <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                                                                                    <p className="text-xs font-bold text-blue-800 mb-2 flex items-center gap-2">
                                                                                        <span className="text-lg">🎯</span>
                                                                                        RUBRIC AREAS
                                                                                    </p>
                                                                                    <div className="flex flex-wrap gap-1">
                                                                                        {item.rubric_impact.split(',').map((area, idx) => (
                                                                                            <span key={idx} className="bg-blue-200 text-blue-900 px-2 py-1 rounded text-xs font-medium">
                                                                                                {area.trim()}
                                                                                            </span>
                                                                                        ))}
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Vocabulary Suggestions - Card Infographic Style */}
                                                    <div>
                                                        <h5 className="text-md font-semibold text-slate-700 mb-3">Vocabulary Enhancement</h5>
                                                        <div className="grid gap-4">
                                                            {feedback.grammar_and_vocabulary.vocabulary_suggestions.map((item, i) => (
                                                                <div key={i} className="bg-white border-2 border-purple-300 rounded-xl overflow-hidden shadow-lg">
                                                                    {/* Top Header */}
                                                                    <div className="bg-gradient-to-r from-purple-500 to-indigo-500 px-4 py-3">
                                                                        <div className="flex items-center justify-between">
                                                                            <div className="flex items-center gap-3">
                                                                                <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center text-xl">
                                                                                    🔍
                                                                                </div>
                                                                                <div>
                                                                                    <p className="text-white font-bold">Replace: "<span className="text-purple-200">{item.original_word}</span>"</p>
                                                                                    {item.location && (
                                                                                        <p className="text-purple-100 text-xs">📍 {item.location}</p>
                                                                                    )}
                                                                                </div>
                                                                            </div>
                                                                            <div className="flex items-center gap-2">
                                                                                {item.occurrences > 0 && (
                                                                                    <div className="bg-white bg-opacity-30 backdrop-blur rounded-full px-3 py-1">
                                                                                        <span className="text-white text-xs font-bold">{item.occurrences}× used</span>
                                                                                    </div>
                                                                                )}
                                                                                {item.impact && (
                                                                                    <div className={`px-4 py-2 rounded-full text-xs font-black ${
                                                                                        item.impact.includes('HIGH') ? 'bg-red-600 text-white' :
                                                                                        item.impact.includes('MEDIUM') ? 'bg-orange-600 text-white' :
                                                                                        item.impact.includes('POSITIVE') ? 'bg-green-600 text-white' :
                                                                                        'bg-yellow-400 text-slate-900'
                                                                                    }`}>
                                                                                        {item.impact.split(' - ')[0]}
                                                                                    </div>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Main Content */}
                                                                    <div className="p-4 space-y-4">
                                                                        {/* Context Example */}
                                                                        {item.context && item.context !== "Your vocabulary appears appropriately academic" && item.context !== "Overall text" && (
                                                                            <div className="bg-purple-50 border-l-4 border-purple-400 rounded p-3">
                                                                                <p className="text-xs font-bold text-purple-800 mb-1 flex items-center gap-2">
                                                                                    <span>💬</span> HOW YOU USED IT
                                                                                </p>
                                                                                <p className="text-xs text-purple-900 font-mono italic">{item.context}</p>
                                                                            </div>
                                                                        )}
                                                                        
                                                                        {/* Better Alternatives - Visual Pills */}
                                                                        <div>
                                                                            <p className="text-xs font-bold text-slate-700 mb-3 flex items-center gap-2">
                                                                                <span className="text-lg">💡</span>
                                                                                BETTER ALTERNATIVES
                                                                            </p>
                                                                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                                                                                {item.suggestions.map((suggestion, j) => (
                                                                                    <div key={j} className="group cursor-pointer">
                                                                                        <div className="bg-gradient-to-br from-purple-400 to-indigo-500 text-white px-4 py-3 rounded-lg text-center font-bold text-sm shadow-md group-hover:shadow-xl group-hover:scale-105 transition-all">
                                                                                            {suggestion}
                                                                                        </div>
                                                                                    </div>
                                                                                ))}
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        {/* Impact Section - Side by Side */}
                                                                        <div className="grid md:grid-cols-2 gap-3">
                                                                            {/* Grade Impact */}
                                                                            {item.impact && (
                                                                                <div className="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                                                                    <p className="text-xs font-bold text-slate-700 mb-2 flex items-center gap-2">
                                                                                        <span className="text-lg">📊</span>
                                                                                        GRADE IMPACT
                                                                                    </p>
                                                                                    <div className="mb-2">
                                                                                        <div className="flex items-center gap-2">
                                                                                            <div className="flex-1 h-3 bg-slate-200 rounded-full overflow-hidden">
                                                                                                <div className={`h-full ${
                                                                                                    item.impact.includes('HIGH') ? 'bg-red-500 w-5/6' :
                                                                                                    item.impact.includes('MEDIUM-HIGH') ? 'bg-orange-500 w-4/6' :
                                                                                                    item.impact.includes('MEDIUM') ? 'bg-orange-400 w-3/6' :
                                                                                                    item.impact.includes('POSITIVE') ? 'bg-green-500 w-5/6' :
                                                                                                    'bg-yellow-400 w-2/6'
                                                                                                }`}></div>
                                                                                            </div>
                                                                                            <span className="text-xs font-bold text-slate-700">
                                                                                                {item.impact.includes('HIGH') ? '85%' :
                                                                                                 item.impact.includes('MEDIUM-HIGH') ? '65%' :
                                                                                                 item.impact.includes('MEDIUM') ? '50%' :
                                                                                                 item.impact.includes('POSITIVE') ? '95%' : '30%'}
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                    <p className="text-xs text-slate-600 leading-snug">
                                                                                        {item.impact.split(' - ').slice(1).join(' - ').substring(0, 100)}...
                                                                                    </p>
                                                                                </div>
                                                                            )}
                                                                            
                                                                            {/* Rubric Impact */}
                                                                            {item.rubric_impact && (
                                                                                <div className="bg-indigo-50 rounded-lg p-3 border border-indigo-200">
                                                                                    <p className="text-xs font-bold text-indigo-800 mb-2 flex items-center gap-2">
                                                                                        <span className="text-lg">🎯</span>
                                                                                        RUBRIC AREAS
                                                                                    </p>
                                                                                    <div className="flex flex-wrap gap-1">
                                                                                        {item.rubric_impact.split(',').map((area, idx) => (
                                                                                            <span key={idx} className="bg-indigo-200 text-indigo-900 px-2 py-1 rounded text-xs font-medium">
                                                                                                {area.trim()}
                                                                                            </span>
                                                                                        ))}
                                                                                    </div>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                        
                                                                        {/* Specific Action Callout */}
                                                                        {item.specific_improvement && (
                                                                            <div className="bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-400 rounded-lg p-3">
                                                                                <p className="text-xs font-bold text-amber-900 mb-2 flex items-center gap-2">
                                                                                    <span className="text-lg">🎯</span>
                                                                                    QUICK ACTION
                                                                                </p>
                                                                                <p className="text-xs text-amber-800 leading-relaxed">{item.specific_improvement}</p>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* AI Detection Section - Only for Essays */}
                                            {feedback.ai_detection && (
                                                <div className="border-t border-slate-200 pt-6">
                                                    <h4 className="text-lg font-semibold text-[#1e3a5f] mb-4 flex items-center gap-2">
                                                        🤖 AI Content Analysis
                                                    </h4>
                                                    
                                                    {/* Score Display */}
                                                    <div className="bg-gradient-to-br from-slate-50 to-slate-100 border-2 border-slate-300 rounded-xl p-6 mb-4">
                                                        <div className="flex flex-col md:flex-row items-center gap-6">
                                                            {/* Pie Chart */}
                                                            <div className="flex-shrink-0">
                                                                <svg width="160" height="160" viewBox="0 0 160 160" className="transform -rotate-90">
                                                                    {/* Background circle */}
                                                                    <circle
                                                                        cx="80"
                                                                        cy="80"
                                                                        r="70"
                                                                        fill="none"
                                                                        stroke="#e2e8f0"
                                                                        strokeWidth="20"
                                                                    />
                                                                    {/* AI portion (red/yellow/green based on score) */}
                                                                    <circle
                                                                        cx="80"
                                                                        cy="80"
                                                                        r="70"
                                                                        fill="none"
                                                                        stroke={
                                                                            feedback.ai_detection.likelihood_score > 70 ? '#ef4444' :
                                                                            feedback.ai_detection.likelihood_score > 50 ? '#eab308' :
                                                                            '#10b981'
                                                                        }
                                                                        strokeWidth="20"
                                                                        strokeDasharray={`${(feedback.ai_detection.likelihood_score / 100) * 439.8} 439.8`}
                                                                        className="transition-all duration-1000"
                                                                    />
                                                                    {/* Center text */}
                                                                    <text
                                                                        x="80"
                                                                        y="80"
                                                                        textAnchor="middle"
                                                                        dominantBaseline="middle"
                                                                        className="transform rotate-90"
                                                                        style={{transformOrigin: '80px 80px'}}
                                                                        fill="#1e293b"
                                                                        fontSize="28"
                                                                        fontWeight="bold"
                                                                    >
                                                                        {feedback.ai_detection.likelihood_score}%
                                                                    </text>
                                                                </svg>
                                                                <div className="flex justify-between items-center mt-3 px-2">
                                                                    <div className="flex items-center gap-2">
                                                                        <div className={`w-3 h-3 rounded-full ${
                                                                            feedback.ai_detection.likelihood_score > 70 ? 'bg-red-500' :
                                                                            feedback.ai_detection.likelihood_score > 50 ? 'bg-yellow-500' :
                                                                            'bg-green-500'
                                                                        }`}></div>
                                                                        <span className="text-xs font-medium text-slate-700">AI-Like</span>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <div className="w-3 h-3 rounded-full bg-slate-300"></div>
                                                                        <span className="text-xs font-medium text-slate-700">Human</span>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            {/* Score Info */}
                                                            <div className="flex-1">
                                                                <div className="mb-4">
                                                                    <div className="text-sm font-medium text-slate-600 mb-1">AI Likelihood Score</div>
                                                                    <div className="text-3xl font-bold text-slate-800">{feedback.ai_detection.likelihood_score}%</div>
                                                                    <div className={`inline-block mt-2 px-3 py-1 rounded-full font-semibold text-xs ${
                                                                        feedback.ai_detection.confidence_level === 'High' ? 'bg-red-100 text-red-800' :
                                                                        feedback.ai_detection.confidence_level === 'Medium' ? 'bg-yellow-100 text-yellow-800' :
                                                                        'bg-green-100 text-green-800'
                                                                    }`}>
                                                                        {feedback.ai_detection.confidence_level} Confidence
                                                                    </div>
                                                                </div>
                                                                
                                                                {/* Score Bar */}
                                                                <div className="relative w-full h-3 bg-slate-200 rounded-full overflow-hidden">
                                                                    <div 
                                                                        className={`absolute top-0 left-0 h-full transition-all duration-500 ${
                                                                            feedback.ai_detection.likelihood_score > 70 ? 'bg-red-500' :
                                                                            feedback.ai_detection.likelihood_score > 50 ? 'bg-yellow-500' :
                                                                            'bg-green-500'
                                                                        }`}
                                                                        style={{width: `${feedback.ai_detection.likelihood_score}%`}}
                                                                    ></div>
                                                                </div>
                                                                <div className="flex justify-between text-xs text-slate-500 mt-2">
                                                                    <span>0% (Human)</span>
                                                                    <span>100% (AI)</span>
                                                                </div>
                                                                
                                                                <p className="text-sm text-slate-700 mt-4">{feedback.ai_detection.analysis}</p>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    {/* Analysis Details */}
                                                    <div className="grid md:grid-cols-2 gap-4 mb-4">
                                                        {/* Human Elements */}
                                                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                                            <h5 className="text-sm font-semibold text-green-900 mb-2 flex items-center gap-2">
                                                                ✅ Human Writing Indicators
                                                            </h5>
                                                            <ul className="space-y-2">
                                                                {feedback.ai_detection.human_elements.map((element, i) => (
                                                                    <li key={i} className="text-sm text-green-800 flex items-start gap-2">
                                                                        <span className="text-green-600 mt-0.5">•</span>
                                                                        <span>{element}</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>

                                                        {/* AI Elements */}
                                                        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                                            <h5 className="text-sm font-semibold text-red-900 mb-2 flex items-center gap-2">
                                                                ⚠️ AI-Like Patterns
                                                            </h5>
                                                            <ul className="space-y-2">
                                                                {feedback.ai_detection.ai_elements.map((element, i) => (
                                                                    <li key={i} className="text-sm text-red-800 flex items-start gap-2">
                                                                        <span className="text-red-600 mt-0.5">•</span>
                                                                        <span>{element}</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    {/* Pattern Indicators */}
                                                    <div className="space-y-3 mb-4">
                                                        <h5 className="text-sm font-semibold text-slate-700">Pattern Analysis</h5>
                                                        {feedback.ai_detection.indicators.map((indicator, i) => (
                                                            <div key={i} className="bg-slate-50 border border-slate-200 rounded-lg p-3">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="text-sm font-medium text-slate-900">{indicator.pattern}</span>
                                                                    <span className={`text-xs px-2 py-1 rounded-full ${
                                                                        indicator.weight === 'strong' ? 'bg-slate-800 text-white' :
                                                                        indicator.weight === 'moderate' ? 'bg-slate-600 text-white' :
                                                                        'bg-slate-400 text-white'
                                                                    }`}>
                                                                        {indicator.weight}
                                                                    </span>
                                                                </div>
                                                                <p className="text-xs text-slate-600">{indicator.explanation}</p>
                                                            </div>
                                                        ))}
                                                    </div>

                                                    {/* Recommendation */}
                                                    <div className={`rounded-lg p-4 ${
                                                        feedback.ai_detection.likelihood_score > 70 ? 'bg-red-50 border border-red-200' :
                                                        feedback.ai_detection.likelihood_score > 55 ? 'bg-yellow-50 border border-yellow-200' :
                                                        'bg-blue-50 border border-blue-200'
                                                    }`}>
                                                        <h5 className="text-sm font-semibold mb-2 flex items-center gap-2">
                                                            {feedback.ai_detection.likelihood_score > 70 ? '🚨' : 
                                                             feedback.ai_detection.likelihood_score > 55 ? '⚡' : 'ℹ️'} Recommendation
                                                        </h5>
                                                        <p className="text-sm text-slate-700">{feedback.ai_detection.recommendation}</p>
                                                    </div>

                                                    {/* Disclaimer */}
                                                    <div className="mt-4 p-3 bg-slate-100 border border-slate-300 rounded-lg">
                                                        <p className="text-xs text-slate-600 italic">
                                                            <strong>Note:</strong> AI detection is not foolproof. This analysis is based on writing patterns and should be considered alongside other assessment methods. False positives and negatives can occur.
                                                        </p>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Next Steps */}
                                            <div className="bg-gradient-to-r from-[#f97316]/10 to-[#ea580c]/10 border border-[#f97316]/20 rounded-lg p-4">
                                                <h4 className="text-lg font-semibold text-[#1e3a5f] mb-2">🎯 Next Steps</h4>
                                                <p className="text-sm text-slate-700">{feedback.next_steps}</p>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="border-0 shadow-lg shadow-slate-200/50 bg-white rounded-lg p-12 text-center">
                                        <div className="w-20 h-20 rounded-full bg-[#1e3a5f]/5 flex items-center justify-center mx-auto mb-6">
                                            <Lightbulb />
                                        </div>
                                        <h3 className="text-xl font-semibold text-[#1e3a5f] mb-2">
                                            Your Feedback Will Appear Here
                                        </h3>
                                        <p className="text-slate-500 max-w-sm mx-auto">
                                            Submit your rubric and assignment to receive personalized, 
                                            growth-focused guidance on your work.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
